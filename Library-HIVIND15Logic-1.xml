<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="None" xsi:type="a:CqlToElmInfo"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="66">
         <a:s>/**
 * Library: HIV.IND.15 Logic
 * Ref No: PRV.15
 * Short Name: VMMC scale-up
 *
 * Definition: Total number of voluntary medical male circumcisions (VMMCs) performed according to national standard during the reporting period
 *
 * Numerator: Total number of people undergoing VMMC performed according to national standard during the reporting period
 * Numerator Calculation: COUNT of clients with a &quot;VMMC procedure date&quot; in the reporting period
 * Numerator Exclusions: 
 *
 * Denominator: 1
 * Denominator Calculation: 1
 * Denominator Exclusions: 
 *
 * Disaggregations:
 * • Age (0–4, 5–9, 10–14, 15–19, 20–24, 25–49, 50+ years) 
 *  • HIV status (positive, negative) 
 *  • Provider type (key population-led or community-led organization, public sector provider, other entities such as private for-profit and not-for-profit organizations, including faith- based, international, nongovernmental) 
 *  • Setting: facility-based service (including hospitals, health clinics, general practice offices, etc.) or community-based service (including drop-in centres, community service delivery points, mobile clinics or vans, outreach teams, community support groups, etc.) 
 *  • Cities and other administrative regions of epidemiologic importance
 *
 * Disaggregation Elements: Age | HIV status
 *
 * Numerator and Denominator Elements:
 * VMMC procedure date
 *
 * Reference: Consolidated guidelines on person-centred HIV strategic information: strengthening routine data for impact. Geneva: World Health Organization; 2022
 * 
 * Data Concepts:
 * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth
 * HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.
 * HIV.B.DE116: HIV-positive | Client is HIV-positive
 * HIV.B.DE117: HIV-negative | Client is HIV-negative
 * HIV.B.DE118: Unknown | Client has unknown HIV status
 * HIV.B.DE198: VMMC procedure date | Date on which a voluntary medical male circumcision procedure was performed
 *
 * Additional Context
 * - what it measures: This indicator measures progress in scaling up male circumcision services.
 * - rationale: WHO and UNAIDS recommend VMMC as an efficacious intervention for HIV prevention in priority* countries and regions with high HIV prevalence and low male circumcision prevalence. |  | Randomized controlled trials have shown that VMMC provided by trained health professionals with proper equipment can reduce the risk of men heterosexually acquiring HIV infection.
 * - method: Individual-level data obtained from programme records (for example, VMMC registers).   |  | The recommended reporting period is 12 months.
 * 
 * Suggested Scoring Method: continuous-variable | http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cv-measure-cqfm
 */

library HIVIND15Logic</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVIND15Logic" system="http://smart.who.int/hiv"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="49:1-49:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>// Included Libraries
using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="51:1-51:44" localIdentifier="HIC" path="http://smart.who.int/hiv/HIVCommon" version="0.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVCommon</a:s>
               </a:s>
               <a:s> version '0.0.1' called HIC</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="52:1-52:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="53:1-53:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="55:1-55:29" localIdentifier="HE" path="http://smart.who.int/hiv/HIVElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVElements</a:s>
               </a:s>
               <a:s> called HE</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="6" locator="56:1-56:39" localIdentifier="HIE" path="http://smart.who.int/hiv/HIVIndicatorElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVIndicatorElements</a:s>
               </a:s>
               <a:s> called HIE</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="12" locator="59:1-59:88" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s>// Indicator Definition
parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="11">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="10">
                     <a:s>Date</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="9">
                  <a:s r="7">Interval[@2023-01-01, @2023-01-30]</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="9" locator="59:55-59:88" lowClosed="true" highClosed="true" xsi:type="Interval">
            <low localId="7" locator="59:64-59:74" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
            </low>
            <high localId="8" locator="59:77-59:87" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="30" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="11" locator="59:32-59:45" xsi:type="IntervalTypeSpecifier">
            <pointType localId="10" locator="59:41-59:44" name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <contexts>
      <def locator="61:1-61:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="61:1-61:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="61:1-61:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="14" locator="68:1-69:6" name="Initial Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="14">
               <a:s r="13">/* Populations */

/*
 *Initial Population
 */

define &quot;Initial Population&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="13" locator="69:3-69:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="23" locator="78:1-81:3" name="Measure Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="23">
               <a:s>/**
 * Measure Population
 *
 * Definition: Total number of people undergoing VMMC performed according to national standard during the reporting period
 * Calculation: Total number of people undergoing VMMC performed according to national standard during the reporting period
 */
                                                       
define &quot;Measure Population&quot;:
  </a:s>
               <a:s r="22">
                  <a:s>exists</a:s>
                  <a:s r="21">
                     <a:s>(</a:s>
                     <a:s r="21">
                        <a:s>
                           <a:s r="16">
                              <a:s r="15">
                                 <a:s>
                                    <a:s>HIC.&quot;VMMC_done&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> VM</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
        </a:s>
                        <a:s r="20">
                           <a:s>where </a:s>
                           <a:s r="20">
                              <a:s>(</a:s>
                              <a:s r="20">
                                 <a:s r="18">
                                    <a:s r="17">
                                       <a:s>VM</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="18">
                                       <a:s>performed</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="20"> during </a:s>
                                 <a:s r="19">
                                    <a:s>&quot;Measurement Period&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="22" locator="79:3-81:3" xsi:type="Exists">
            <operand localId="21" locator="79:9-81:3" xsi:type="Query">
               <source localId="16" locator="79:10-79:27" alias="VM">
                  <expression localId="15" locator="79:10-79:24" name="VMMC_done" libraryName="HIC" xsi:type="ExpressionRef"/>
               </source>
               <where localId="20" locator="80:9-80:56" xsi:type="IncludedIn">
                  <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:Period" xsi:type="As">
                        <operand localId="18" locator="80:16-80:27" path="performed" scope="VM" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand xsi:type="Interval">
                     <low xsi:type="ToDateTime">
                        <operand path="low" xsi:type="Property">
                           <source localId="19" locator="80:36-80:55" name="Measurement Period" xsi:type="ParameterRef"/>
                        </operand>
                     </low>
                     <lowClosedExpression path="lowClosed" xsi:type="Property">
                        <source localId="19" locator="80:36-80:55" name="Measurement Period" xsi:type="ParameterRef"/>
                     </lowClosedExpression>
                     <high xsi:type="ToDateTime">
                        <operand path="high" xsi:type="Property">
                           <source localId="19" locator="80:36-80:55" name="Measurement Period" xsi:type="ParameterRef"/>
                        </operand>
                     </high>
                     <highClosedExpression path="highClosed" xsi:type="Property">
                        <source localId="19" locator="80:36-80:55" name="Measurement Period" xsi:type="ParameterRef"/>
                     </highClosedExpression>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="26" locator="90:1-91:3" name="Measure Observation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="26">
               <a:s>/**
 * Measure Observation
 * Definition: Total number of people undergoing VMMC performed according to national standard during the reporting period
 * Calculation: Total number of people undergoing VMMC performed according to national standard during the reporting period                                                      
 */     

define function &quot;Measure Observation&quot;(Patient &quot;Patient&quot;):
  </a:s>
               <a:s r="25">
                  <a:s r="25">1</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="25" locator="91:3" valueType="t:Integer" value="1" xsi:type="Literal"/>
         <operand name="Patient">
            <operandTypeSpecifier localId="24" locator="90:47-90:55" name="fhir:Patient" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="29" locator="99:1-100:42" name="Administrative Gender Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="29">
               <a:s>/* end Populations */


/*
 * Disaggregators
 */

define &quot;Administrative Gender Stratifier&quot;:
	</a:s>
               <a:s r="28">
                  <a:s r="27">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="28">
                     <a:s>&quot;By Administrative Gender Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="28" locator="100:2-100:42" name="By Administrative Gender Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="32" locator="102:1-103:26" name="Age Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="32">
               <a:s>define &quot;Age Stratifier&quot;:
	</a:s>
               <a:s r="31">
                  <a:s r="30">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="31">
                     <a:s>&quot;By Age Stratifier 3&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="31" locator="103:2-103:26" name="By Age Stratifier 3" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="35" locator="105:1-106:38" name="Geographic Region Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="35">
               <a:s>define &quot;Geographic Region Stratifier&quot;:
	</a:s>
               <a:s r="34">
                  <a:s r="33">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="34">
                     <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="34" locator="106:2-106:38" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="38" locator="108:1-109:17" name="Setting" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="38">
               <a:s>define &quot;Setting&quot;:
    </a:s>
               <a:s r="37">
                  <a:s r="36">
                     <a:s>HIC</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="37">
                     <a:s>&quot;setting&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="37" locator="109:5-109:17" name="setting" libraryName="HIC" xsi:type="ExpressionRef"/>
      </def>
      <def localId="41" locator="111:1-112:20" name="HIV Status" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="41">
               <a:s>define &quot;HIV Status&quot;:
    </a:s>
               <a:s r="40">
                  <a:s r="39">
                     <a:s>HIC</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="40">
                     <a:s>&quot;HIV Status&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="40" locator="112:5-112:20" name="HIV Status" libraryName="HIC" xsi:type="ExpressionRef"/>
      </def>
      <def localId="66" locator="116:1-121:29" name="Stratification" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="66">
               <a:s>//provider type not provided?

define &quot;Stratification&quot;:
 </a:s>
               <a:s r="65">
                  <a:s r="61">
                     <a:s r="59">
                        <a:s r="54">
                           <a:s r="51">
                              <a:s r="49">
                                 <a:s r="46">
                                    <a:s r="44">
                                       <a:s r="43">
                                          <a:s r="42">
                                             <a:s>HIE</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="43">
                                             <a:s>&quot;By Administrative Gender Stratifier&quot;</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="44">
                                          <a:s>code</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> 
  + </a:s>
                                    <a:s r="45">
                                       <a:s>':'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="48">
                                    <a:s r="47">
                                       <a:s>HIE</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="48">
                                       <a:s>&quot;By Age Stratifier&quot;</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
+ </a:s>
                              <a:s r="50">
                                 <a:s>':'</a:s>
                              </a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="53">
                              <a:s r="52">
                                 <a:s>HIE</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="53">
                                 <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
+ </a:s>
                        <a:s r="58">
                           <a:s>Combine(</a:s>
                           <a:s r="56">
                              <a:s r="55">
                                 <a:s>HIC</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="56">
                                 <a:s>setting</a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="57">
                              <a:s>':'</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
+ </a:s>
                     <a:s r="60">
                        <a:s>':'</a:s>
                     </a:s>
                  </a:s>
                  <a:s> + </a:s>
                  <a:s r="64">
                     <a:s r="63">
                        <a:s r="62">
                           <a:s>HIC</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="63">
                           <a:s>&quot;HIV Status&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="64">
                        <a:s>code</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="65" locator="117:2-121:29" xsi:type="Concatenate">
            <operand localId="61" locator="117:2-121:5" xsi:type="Concatenate">
               <operand localId="59" locator="117:2-120:27" xsi:type="Concatenate">
                  <operand localId="54" locator="117:2-119:45" xsi:type="Concatenate">
                     <operand localId="51" locator="117:2-119:5" xsi:type="Concatenate">
                        <operand localId="49" locator="117:2-118:33" xsi:type="Concatenate">
                           <operand localId="46" locator="117:2-118:7" xsi:type="Concatenate">
                              <operand localId="44" locator="117:2-117:47" path="code" xsi:type="Property">
                                 <source localId="43" locator="117:2-117:42" name="By Administrative Gender Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                              </operand>
                              <operand localId="45" locator="118:5-118:7" valueType="t:String" value=":" xsi:type="Literal"/>
                           </operand>
                           <operand localId="48" locator="118:11-118:33" name="By Age Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                        </operand>
                        <operand localId="50" locator="119:3-119:5" valueType="t:String" value=":" xsi:type="Literal"/>
                     </operand>
                     <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="53" locator="119:9-119:45" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                     </operand>
                  </operand>
                  <operand localId="58" locator="120:3-120:27" xsi:type="Combine">
                     <source localId="56" locator="120:11-120:21" name="setting" libraryName="HIC" xsi:type="ExpressionRef"/>
                     <separator localId="57" locator="120:24-120:26" valueType="t:String" value=":" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand localId="60" locator="121:3-121:5" valueType="t:String" value=":" xsi:type="Literal"/>
            </operand>
            <operand localId="64" locator="121:9-121:29" path="code" xsi:type="Property">
               <source localId="63" locator="121:9-121:24" name="HIV Status" libraryName="HIC" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
   </statements>
</library>
