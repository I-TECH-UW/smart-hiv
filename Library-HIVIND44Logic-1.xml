<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="None" xsi:type="a:CqlToElmInfo"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="67">
         <a:s>/**
 * Library: HIV.IND.44 Logic
 * Ref No: TBH.1
 * Short Name: TPT initiation
 *
 * Definition: Number and % of eligible people living with HIV on ART who initiated TB preventive treatment
 *
 * Numerator: Number of ART patients who initiated TPT during the reporting period
 * Numerator Calculation: COUNT of clients with &quot;HIV status&quot;='HIV-positive' AND &quot;On ART&quot;=True AND &quot;TB preventive treatment (TPT) start date&quot; in the reporting period
 * Numerator Exclusions: 
 *
 * Denominator: Number of ART patients who are eligible for TPT during the reporting period
 * Denominator Calculation: COUNT of clients with &quot;HIV status&quot;='HIV-positive' AND &quot;On ART&quot;=True at end of last reporting period AND &quot;Eligible for TB preventive treatment&quot;=True
 * Denominator Exclusions: 
 *
 * Disaggregations:
 *  • Gender (female, male, other*) 
 *  • Age (0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40–44, 45–49, 50+ years)** 
 *  • Type of TPT regimen 
 *  • Cities and other administrative regions of epidemiologic importance
 *
 * Disaggregation Elements: Gender | Age | TPT regimen type
 *
 * Numerator and Denominator Elements:
 * Eligible for TB preventive treatment 
 *  HIV status 
 *  On ART 
 *  TB preventive treatment (TPT) start date
 *
 * Reference: Consolidated guidelines on person-centred HIV strategic information: strengthening routine data for impact. Geneva: World Health Organization; 2022
 * 
 * Data Concepts:
 * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth
 * HIV.A.DE18: Gender* | Gender of the client*
 * HIV.A.DE19: Female | Client identifies as female
 * HIV.A.DE20: Male | Client identifies as male
 * HIV.A.DE21: Transgender male | Client identifies as transgender male
 * HIV.A.DE22: Transgender female | Client identifies as transgender female
 * HIV.A.DE23: Other | Additional category
 * HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.
 * HIV.B.DE116: HIV-positive | Client is HIV-positive
 * HIV.B.DE117: HIV-negative | Client is HIV-negative
 * HIV.B.DE118: Unknown | Client has unknown HIV status
 * HIV.D.DE38: On ART | Client is currently taking ART
 * HIV.D.DE954: TB preventive treatment (TPT) start date | The date on which the client began taking TPT
 * HIV.D.DE1017: Eligible for TB preventive treatment | Client is eligible for tuberculosis preventive treatment (TPT)
 * HIV.D.DE1028: TPT regimen type | Type of TPT regimen the client is currently on
 * HIV.D.DE1029: 3HP | The client's current TPT regimen is 3HP
 * HIV.D.DE1030: 1HP | The client's current TPT regimen is 1HP
 * HIV.D.DE1031: 6H | The client's current TPT regimen is 6H
 * HIV.D.DE1032: Six months of levofloxacin daily | The client's current TPT regimen is six months of levofloxacin daily
 * HIV.D.DE1033: Other TB preventive treatment (TPT) regimen | The client's current TPT regimen is another regimen than those listed above
 * HIV.H.DE47: On ART | Client is currently taking ART 
 *
 * Additional Context
 * - what it measures: This indicator measures the extent to which people on ART initiated treatment for latent TB infection.
 * - rationale: • TB preventive treatment (TPT) is a critical component of preventing TB-related morbidity and mortality among people living with HIV. | • In the wake of recent high-level global commitments and targets, this is a critical period to track the progress that countries have made in scaling up TPT coverage.
 * - method: For the numerator: Programme records (for example, ART registers) | For the denominator: Formula for determining the number of ART patients who are eligible for TPT during the reporting period | Number of people living with HIV on ART at end of last reporting period | minus | Number of notified HIV-positive TB patients in last reporting period | also minus, where possible | Number of people living with HIV who previously received TPT – actual, if available, or based on country estimate | also minus, where possible number/estimate of people living with HIV not eligible for TPT due to co-morbidities, including active hepatitis, chronic alcoholism and/or neuropathy
 * 
 * Suggested Scoring Method: proportion | http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/proportion-measure-cqfm
 */

library HIVIND44Logic</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVIND44Logic" system="http://smart.who.int/hiv"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="66:1-66:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>// Included Libraries
using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="68:1-68:28" localIdentifier="HIC" path="http://smart.who.int/hiv/HIVCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVCommon</a:s>
               </a:s>
               <a:s> called HIC</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="69:1-69:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="71:1-71:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="73:1-73:29" localIdentifier="HE" path="http://smart.who.int/hiv/HIVElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVElements</a:s>
               </a:s>
               <a:s> called HE</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="6" locator="74:1-74:39" localIdentifier="HIE" path="http://smart.who.int/hiv/HIVIndicatorElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVIndicatorElements</a:s>
               </a:s>
               <a:s> called HIE</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="12" locator="77:1-77:88" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s>// Indicator Definition
parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="11">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="10">
                     <a:s>Date</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="9">
                  <a:s r="7">Interval[@2023-01-01, @2023-01-30]</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="9" locator="77:55-77:88" lowClosed="true" highClosed="true" xsi:type="Interval">
            <low localId="7" locator="77:64-77:74" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
            </low>
            <high localId="8" locator="77:77-77:87" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="30" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="11" locator="77:32-77:45" xsi:type="IntervalTypeSpecifier">
            <pointType localId="10" locator="77:41-77:44" name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <contexts>
      <def locator="79:1-79:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="79:1-79:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="79:1-79:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="14" locator="86:1-87:6" name="Initial Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="14">
               <a:s r="13">/* Populations */

/*
 *Initial Population
 */

define &quot;Initial Population&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="13" locator="87:3-87:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="24" locator="96:1-97:126" name="Numerator" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="24">
               <a:s>/**
 * Numerator
 * 
 * Definition: Number of ART patients who initiated TPT during the reporting period
 * Calculation: COUNT of clients with &quot;HIV status&quot;='HIV-positive' AND &quot;On ART&quot;=True AND &quot;TB preventive treatment (TPT) start date&quot; in the reporting period
 */

define &quot;Numerator&quot;:
 </a:s>
               <a:s r="23">
                  <a:s r="19">
                     <a:s r="16">
                        <a:s r="15">
                           <a:s>HIE</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="16">
                           <a:s>&quot;Has HIV-positive Status&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="18">
                        <a:s r="17">
                           <a:s>HIE</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="18">
                           <a:s>&quot;On ART&quot;</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s> and </a:s>
                  <a:s r="22">
                     <a:s>exists</a:s>
                     <a:s r="21">
                        <a:s>(</a:s>
                        <a:s r="21">
                           <a:s r="20">
                              <a:s>HIE</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="21">
                              <a:s>&quot;TB preventive treatment TPT start date in measurement period&quot;</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="23" locator="97:2-97:126" xsi:type="And">
            <operand localId="19" locator="97:2-97:47" xsi:type="And">
               <operand localId="16" locator="97:2-97:30" name="Has HIV-positive Status" libraryName="HIE" xsi:type="ExpressionRef"/>
               <operand localId="18" locator="97:36-97:47" name="On ART" libraryName="HIE" xsi:type="ExpressionRef"/>
            </operand>
            <operand localId="22" locator="97:53-97:126" xsi:type="Exists">
               <operand localId="21" locator="97:59-97:126" name="TB preventive treatment TPT start date in measurement period" libraryName="HIE" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
      <def localId="33" locator="106:1-107:94" name="Denominator" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="33">
               <a:s>/**
 * Denominator
 *
 * Definition: Number of ART patients who are eligible for TPT during the reporting period
 * Calculation: COUNT of clients with &quot;HIV status&quot;='HIV-positive' AND &quot;On ART&quot;=True at end of last reporting period AND &quot;Eligible for TB preventive treatment&quot;=True
 */

define &quot;Denominator&quot;:
 </a:s>
               <a:s r="32">
                  <a:s r="29">
                     <a:s r="26">
                        <a:s r="25">
                           <a:s>HIE</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="26">
                           <a:s>&quot;Has HIV-positive Status&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="28">
                        <a:s r="27">
                           <a:s>HIE</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="28">
                           <a:s>&quot;On ART&quot;</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s> and </a:s>
                  <a:s r="31">
                     <a:s r="30">
                        <a:s>HIE</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="31">
                        <a:s>&quot;Eligible for TB preventive treatment&quot;</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="32" locator="107:2-107:94" xsi:type="And">
            <operand localId="29" locator="107:2-107:47" xsi:type="And">
               <operand localId="26" locator="107:2-107:30" name="Has HIV-positive Status" libraryName="HIE" xsi:type="ExpressionRef"/>
               <operand localId="28" locator="107:36-107:47" name="On ART" libraryName="HIE" xsi:type="ExpressionRef"/>
            </operand>
            <operand localId="31" locator="107:53-107:94" name="Eligible for TB preventive treatment" libraryName="HIE" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="36" locator="120:1-121:42" name="Administrative Gender Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="36">
               <a:s>/* end Populations */

/*
 * Disaggregations:
 *  • Gender (female, male, other*) 
 *  • Age (0–4, 5–9, 10–14, 15–19, 20–24, 25–29, 30–34, 35–39, 40–44, 45–49, 50+ years)** 
 *  • Type of TPT regimen 
 *  • Cities and other administrative regions of epidemiologic importance
 */

define &quot;Administrative Gender Stratifier&quot;:
	</a:s>
               <a:s r="35">
                  <a:s r="34">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="35">
                     <a:s>&quot;By Administrative Gender Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="35" locator="121:2-121:42" name="By Administrative Gender Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="39" locator="123:1-124:25" name="Age Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="39">
               <a:s>define &quot;Age Stratifier&quot;:
  </a:s>
               <a:s r="38">
                  <a:s r="37">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="38">
                     <a:s>&quot;By Age Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="38" locator="124:3-124:25" name="By Age Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="42" locator="126:1-127:24" name="TPT Regimen Type Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="42">
               <a:s>define &quot;TPT Regimen Type Stratifier&quot;:
  </a:s>
               <a:s r="41">
                  <a:s r="40">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="41">
                     <a:s>&quot;TPT regimen type&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="41" locator="127:3-127:24" name="TPT regimen type" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="45" locator="129:1-130:39" name="Geographic Region Stratifier" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="45">
               <a:s>define &quot;Geographic Region Stratifier&quot;:
  </a:s>
               <a:s r="44">
                  <a:s r="43">
                     <a:s>HIE</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="44">
                     <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="44" locator="130:3-130:39" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
      </def>
      <def localId="67" locator="135:1-139:48" name="Stratification" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="67">
               <a:s>/*
 * Combined stratifiers
 */
define &quot;Stratification&quot;:
  </a:s>
               <a:s r="66">
                  <a:s r="63">
                     <a:s r="61">
                        <a:s r="55">
                           <a:s r="53">
                              <a:s r="50">
                                 <a:s r="48">
                                    <a:s r="47">
                                       <a:s r="46">
                                          <a:s>HIE</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="47">
                                          <a:s>&quot;By Administrative Gender Stratifier&quot;</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="48">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> 
    + </a:s>
                                 <a:s r="49">
                                    <a:s>':'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="52">
                                 <a:s r="51">
                                    <a:s>HIE</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="52">
                                    <a:s>&quot;By Age Stratifier&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    + </a:s>
                           <a:s r="54">
                              <a:s>':'</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="60">
                           <a:s>Combine(</a:s>
                           <a:s r="59">
                              <a:s r="58">
                                 <a:s r="57">
                                    <a:s r="56">
                                       <a:s>HIE</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="57">
                                       <a:s>&quot;TPT regimen type&quot;</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="58">
                                    <a:s>coding</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="59">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
	  + </a:s>
                     <a:s r="62">
                        <a:s>':'</a:s>
                     </a:s>
                  </a:s>
                  <a:s> + </a:s>
                  <a:s r="65">
                     <a:s r="64">
                        <a:s>HIE</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="65">
                        <a:s>&quot;By Geographic Region Stratifier&quot;</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="66" locator="136:3-139:48" xsi:type="Concatenate">
            <operand localId="63" locator="136:3-139:8" xsi:type="Concatenate">
               <operand localId="61" locator="136:3-138:55" xsi:type="Concatenate">
                  <operand localId="55" locator="136:3-138:9" xsi:type="Concatenate">
                     <operand localId="53" locator="136:3-137:35" xsi:type="Concatenate">
                        <operand localId="50" locator="136:3-137:9" xsi:type="Concatenate">
                           <operand localId="48" locator="136:3-136:48" path="code" xsi:type="Property">
                              <source localId="47" locator="136:3-136:43" name="By Administrative Gender Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                           </operand>
                           <operand localId="49" locator="137:7-137:9" valueType="t:String" value=":" xsi:type="Literal"/>
                        </operand>
                        <operand localId="52" locator="137:13-137:35" name="By Age Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
                     </operand>
                     <operand localId="54" locator="138:7-138:9" valueType="t:String" value=":" xsi:type="Literal"/>
                  </operand>
                  <operand localId="60" locator="138:13-138:55" xsi:type="Combine">
                     <source xsi:type="Query">
                        <source alias="X">
                           <expression localId="59" locator="138:21-138:54" xsi:type="Query">
                              <source alias="$this">
                                 <expression localId="58" locator="138:21-138:49" xsi:type="Flatten">
                                    <operand xsi:type="Query">
                                       <source alias="$this">
                                          <expression localId="57" locator="138:21-138:42" name="TPT regimen type" libraryName="HIE" xsi:type="ExpressionRef"/>
                                       </source>
                                       <where xsi:type="Not">
                                          <operand xsi:type="IsNull">
                                             <operand path="coding" xsi:type="Property">
                                                <source name="$this" xsi:type="AliasRef"/>
                                             </operand>
                                          </operand>
                                       </where>
                                       <return distinct="false">
                                          <expression path="coding" xsi:type="Property">
                                             <source name="$this" xsi:type="AliasRef"/>
                                          </expression>
                                       </return>
                                    </operand>
                                 </expression>
                              </source>
                              <where xsi:type="Not">
                                 <operand xsi:type="IsNull">
                                    <operand path="code" xsi:type="Property">
                                       <source name="$this" xsi:type="AliasRef"/>
                                    </operand>
                                 </operand>
                              </where>
                              <return distinct="false">
                                 <expression path="code" xsi:type="Property">
                                    <source name="$this" xsi:type="AliasRef"/>
                                 </expression>
                              </return>
                           </expression>
                        </source>
                        <return distinct="false">
                           <expression name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <operand name="X" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </source>
                  </operand>
               </operand>
               <operand localId="62" locator="139:6-139:8" valueType="t:String" value=":" xsi:type="Literal"/>
            </operand>
            <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand localId="65" locator="139:12-139:48" name="By Geographic Region Stratifier" libraryName="HIE" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
   </statements>
</library>
