<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="16">
         <a:s>/**
 * Library: HIV.IND.43 Logic
 * Ref No: VER.7
 * Short Name: HIV prevalence among women attending ANC
 *
 * Definition: % of pregnant women who are HIV-positive at the time of their first test during the current pregnancy
 *
 * Numerator: Number of ANC attendees who tested HIV-positive at their first test during the current pregnancy plus number of ANC attendees known to be HIV-positive before their first ANC visit
 * Numerator Calculation: COUNT of &quot;Currently pregnant&quot; clients with &quot;HIV test result&quot;='HIV-positive' AND &quot;HIV test date&quot; on &quot;ANC contact date&quot; is EARLIEST within current pregnancy | PLUS | COUNT of clients with &quot;HIV status&quot;='HIV-positive' on first &quot;ANC contact date&quot;
 * Numerator Exclusions: 
 *
 * Denominator: Number of ANC attendees receiving their first HIV test during pregnancy plus number of ANC attendees known to be HIV-positive before first ANC visit
 * Denominator Calculation: COUNT of &quot;Currently pregnant&quot; clients with &quot;HIV test date&quot; on a &quot;ANC contact date&quot; during current pregnancy | PLUS | COUNT of clients with &quot;HIV status&quot;='HIV-positive' on first &quot;ANC contact date&quot;
 * Denominator Exclusions: 
 *
 * Disaggregations:
 * • Age (&lt;15, 15–19, 20–24, 25–29, 30–34, 35–39, 40–49, 50+ years) 
 *  • HIV status at first test during current pregnancy (known positive, tested HIV-negative, tested HIV-positive, not tested) 
 *  • Cities and other administrative regions of epidemiologic importance
 *
 * Disaggregation Elements: Age | HIV status at first HIV test during current pregnancy
 *
 * Numerator and Denominator Elements:
 * ANC contact date 
 *  Currently pregnant 
 *  HIV status 
 *  HIV test date 
 *  HIV test result
 *
 * Reference: Consolidated guidelines on person-centred HIV strategic information: strengthening routine data for impact. Geneva: World Health Organization; 2022
 * 
 * Data Concepts:
 * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth
 * HIV.B.DE29: Currently pregnant | Client is currently pregnant
 * HIV.B.DE110: HIV test date | Date of the HIV test
 * HIV.B.DE111: HIV test result | The result from HIV testing after applying the testing algorithm
 * HIV.B.DE112: HIV-positive | Test result is HIV-positive
 * HIV.B.DE113: HIV-negative | Test result is HIV-negative
 * HIV.B.DE114: HIV-inconclusive | Test result is HIV-inconclusive
 * HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.
 * HIV.B.DE116: HIV-positive | Client is HIV-positive
 * HIV.B.DE117: HIV-negative | Client is HIV-negative
 * HIV.B.DE118: Unknown | Client has unknown HIV status
 * HIV.D.DE31: Currently pregnant | Client is currently pregnant
 * HIV.E.DE85: ANC contact date | The date and time of the client's ANC contact (in the ANC DAK this is called 'Contact date')
 * HIV.E.DE224: HIV test date | Date of the HIV test
 * HIV.SRV.DE1: HIV test date | Date of the HIV test
 * HIV.SRV.DE2: HIV test result | The result from HIV testing after applying the testing algorithm
 * HIV.SRV.DE7: Currently pregnant | Client is currently pregnant
 * HIV.SRV.DE18: ANC contact date | The date and time of the client's ANC contact (in the ANC DAK this is called 'Contact date')
 *
 * Additional Context
 * - what it measures: HIV prevalence among pregnant women attending ANC, including those who were diagnosed with HIV before their first ANC visit and those testing positive during their current pregnancy.
 * - rationale: HIV prevalence among ANC attendees is used for surveillance to measure HIV prevalence and incidence and to monitor trends in HIV infection when the following conditions are met to ensure that HIV prevalence among ANC clients is consistently representative of HIV prevalence among all pregnant women: | • ANC attendance is high and all women are recorded (for example, not missing large private-sector ANC services). | • HIV testing is offered to all pregnant women and not restricted to only higher-risk women or interrupted due to stock-outs of test kits. | • Only the first HIV test result is used to calculate HIV prevalence during a single pregnancy. | • Women who are already known to be HIV-positive and/or are already on ART prior to their first ANC visit during a pregnancy and, therefore, are not tested for HIV, are recorded | and included in routine reporting. All HIV-positive women must be included in both the numerator and denominator when calculating HIV prevalence among pregnant women. |  | See section 5.2 4 on WHO's 2022 HIV SI Guidelines on routine antenatal HIV testing for more detail. | This indicator is also useful for estimating the number of women in need of PMTCT services for programme planning purposes.
 * - method: ANC registers, patient monitoring tools, EMRs (for example, patient records). |  | The recommended reporting period is 12 months.
 * 
 * Suggested Scoring Method: proportion | http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/proportion-measure-cqfm
 */

library HIVIND43Logic</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVIND43Logic" system="http://smart.who.int/hiv"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="63:1-63:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>// Included Libraries
using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="65:1-65:44" localIdentifier="HIC" path="http://smart.who.int/hiv/HIVCommon" version="0.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVCommon</a:s>
               </a:s>
               <a:s> version '0.0.1' called HIC</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="66:1-66:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="68:1-68:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="10" locator="71:1-71:88" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="10">
               <a:s>// Indicator Definition
parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="9">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="8">
                     <a:s>Date</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="7">
                  <a:s r="5">Interval[@2023-01-01, @2023-01-30]</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="7" locator="71:55-71:88" lowClosed="true" highClosed="true" xsi:type="Interval">
            <low localId="5" locator="71:64-71:74" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
            </low>
            <high localId="6" locator="71:77-71:87" xsi:type="Date">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="30" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="9" locator="71:32-71:45" xsi:type="IntervalTypeSpecifier">
            <pointType localId="8" locator="71:41-71:44" name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <contexts>
      <def locator="73:1-73:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="73:1-73:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="73:1-73:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="12" locator="80:1-81:6" name="Initial Population" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s r="11">/* Populations */

/*
 *Initial Population
 */

define &quot;Initial Population&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="11" locator="81:3-81:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="14" locator="90:1-91:6" name="Numerator" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="14">
               <a:s r="13">/**
 * Numerator
 * 
 * Definition: Number of ANC attendees who tested HIV-positive at their first test during the current pregnancy plus number of ANC attendees known to be HIV-positive before their first ANC visit
 * Calculation: COUNT of &quot;Currently pregnant&quot; clients with &quot;HIV test result&quot;='HIV-positive' AND &quot;HIV test date&quot; on &quot;ANC contact date&quot; is EARLIEST within current pregnancy | PLUS | COUNT of clients with &quot;HIV status&quot;='HIV-positive' on first &quot;ANC contact date&quot;
 */

define &quot;Numerator&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="13" locator="91:3-91:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
      <def localId="16" locator="101:1-102:6" name="Denominator" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="16">
               <a:s r="15">/**
 * Denominator
 *
 * Definition: Number of ANC attendees receiving their first HIV test during pregnancy plus number of ANC attendees known to be HIV-positive before first ANC visit
 * Calculation: COUNT of &quot;Currently pregnant&quot; clients with &quot;HIV test date&quot; on a &quot;ANC contact date&quot; during current pregnancy | PLUS | COUNT of clients with &quot;HIV status&quot;='HIV-positive' on first &quot;ANC contact date&quot;
 */

define &quot;Denominator&quot;:
  true</a:s>
            </a:s>
         </annotation>
         <expression localId="15" locator="102:3-102:6" valueType="t:Boolean" value="true" xsi:type="Literal"/>
      </def>
   </statements>
</library>
