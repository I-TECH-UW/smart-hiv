<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="None" xsi:type="a:CqlToElmInfo"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToDateTime has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToDateTime has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToDateTime has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToDateTime has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToInterval has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation message="The function FHIRHelpers.ToString has multiple overloads and due to the SignatureLevel setting (None), the overload signature is not being included in the output. This may result in ambiguous function resolution at runtime, consider setting the SignatureLevel to Overloads or All to ensure that the output includes sufficient information to support correct overload selection at runtime." errorType="semantic" errorSeverity="warning" xsi:type="a:CqlToElmError"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="684">
         <a:s>library HIVCommon version '0.0.1'</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVCommon" system="http://smart.who.int/hiv" version="0.0.1"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="3:1-3:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="5:1-5:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="6:1-6:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="8:1-8:35" localIdentifier="Concepts" path="http://smart.who.int/hiv/HIVConcepts">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVConcepts</a:s>
               </a:s>
               <a:s> called Concepts</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="9:1-9:47" localIdentifier="CustomConcepts" path="http://smart.who.int/hiv/HIVConceptsCustom">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVConceptsCustom</a:s>
               </a:s>
               <a:s> called CustomConcepts</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <contexts>
      <def locator="11:1-11:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="11:1-11:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="11:1-11:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="86" locator="95:1-106:7" name="GetDurationInDays" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="86">
               <a:s>//VERIFIED


//DRAFT



//need to add Time to start ART (within 7, 30 or 90 days of diagnosis, as per country guidelines)
//need to add Disaggregation by time since diagnosis
  


/* 
* DAK has codes for HAART misspecified 
* ICD-10 Z92.2	Other prophylactic chemotherapy		
* LOINC &quot;54825-5	&quot;	On scheduled pain medication regimen in last 7 days
*
* Should discuss 
*/







/*
* Kenya EMR defined as HIV positive condition
* Will need to discuss if produce flags through conditions for concepts to use in indicator calculation such as HIV positive and On ART
* However, we have moved forward with a more prescriptive approach 
* Inevitably our approach requires that certain data elements be available
*/

/*
 * HIV Treatment during the measurement period
 * uses dosage and dispensation amount to estimate last day of medication
 * medication should be dispensed before end of measurement period
 * medication should last until after 28 days after the end of the measurement period
 * This takes into account lost to follow up
 */

/*
*define &quot;HIV Treatment during the measurement period&quot;:
*   [MedicationDispense] MD
*    where MD.status in { 'final', 'amended', 'corrected' }
*    and MD.medication ~ 'Antiretroviral'
*    and MD.whenHandedOver before end of &quot;Measurement Period&quot;
*    and (MD.whenHandedOver + MD.dosageInstruction[0].timing.repeat.duration.value * MedicationDispense.quantity.value) after (measurementPeriod.end - 28 days)
*/ 

/*
* Immunization defines HAART as
*  exists([MedicationAdministration] A where ExtractMedicationCode(A.medication) in IMMZc.&quot;ARV Drugs&quot; and A.status = 'in-progress')
* I believe this is the incorrect resource unless they mean to say that medication is given during a medical encounter
* would like to discuss 
*/ 

/** 
 * Patient Deceased During Measurement Period
 * Immunization defines this as true when is a boolean. This may have the effect of deleting a person from indicators in all calculations
 * Should intend to use when patient.deceased FHIR boolean was updated to TRUE if no other date is available
 * Kenya EMR example does not account for when deceased is just a boolean
 */


/*
define &quot;PREP Prescription Days&quot;:
  Sum(
    (
      collapse (
        [MedicationRequest] MR
          where MR.status = 'completed'
          and MR.intent = 'order'
          and MR.medication ~ Concepts.&quot;PrEP for HIV prevention&quot;
        return WComV2.&quot;Prescription Relevant Period&quot;( MR ) intersect &quot;Measurement Period&quot;
      )
    ) PREPUseInterval
      return days between start of PREPUseInterval and end of PREPUseInterval
  )
*/


define function GetDurationInDays(value FHIR.Duration): // returns Decimal:
    </a:s>
               <a:s r="85">
                  <a:s r="85">
                     <a:s>case </a:s>
                     <a:s r="9">
                        <a:s r="8">
                           <a:s r="7">
                              <a:s>value</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="8">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="9">
                           <a:s>value</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="15">
                        <a:s>when </a:s>
                        <a:s r="10">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="14">
                           <a:s r="12">
                              <a:s r="11">
                                 <a:s>value</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="12">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="13"> * 365.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="22">
                        <a:s>when </a:s>
                        <a:s r="16">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="21">
                           <a:s r="19">
                              <a:s r="18">
                                 <a:s r="17">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="18">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="19">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="20"> * 30.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="29">
                        <a:s>when </a:s>
                        <a:s r="23">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="28">
                           <a:s r="26">
                              <a:s r="25">
                                 <a:s r="24">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="25">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="26">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="27"> * 7.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="34">
                        <a:s>when </a:s>
                        <a:s r="30">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="33">
                           <a:s r="32">
                              <a:s r="31">
                                 <a:s>value</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="32">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="33">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="41">
                        <a:s>when </a:s>
                        <a:s r="35">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="40">
                           <a:s r="38">
                              <a:s r="37">
                                 <a:s r="36">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="37">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="38">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="39"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="50">
                        <a:s>when </a:s>
                        <a:s r="42">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="49">
                           <a:s r="47">
                              <a:s r="45">
                                 <a:s r="44">
                                    <a:s r="43">
                                       <a:s>value</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="44">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="45">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="46"> / 60.0</a:s>
                           </a:s>
                           <a:s r="48"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="61">
                        <a:s>when </a:s>
                        <a:s r="51">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="60">
                           <a:s r="58">
                              <a:s r="56">
                                 <a:s r="54">
                                    <a:s r="53">
                                       <a:s r="52">
                                          <a:s>value</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="53">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="54">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="55"> / 60.0</a:s>
                              </a:s>
                              <a:s r="57"> / 60.0</a:s>
                           </a:s>
                           <a:s r="59"> / 24.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      </a:s>
                     <a:s r="74">
                        <a:s>when </a:s>
                        <a:s r="62">
                           <a:s>'ms'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="73">
                           <a:s r="71">
                              <a:s r="69">
                                 <a:s r="67">
                                    <a:s r="65">
                                       <a:s r="64">
                                          <a:s r="63">
                                             <a:s>value</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="64">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="65">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="66"> / 60.0</a:s>
                                 </a:s>
                                 <a:s r="68"> / 60.0</a:s>
                              </a:s>
                              <a:s r="70"> / 24.0</a:s>
                           </a:s>
                           <a:s r="72"> / 1000.0</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
      else </a:s>
                     <a:s r="84">
                        <a:s r="75">Message(1000, true, </a:s>
                        <a:s r="77">
                           <a:s>'Undefined'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="78">
                           <a:s>'Error'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="83">
                           <a:s r="79">
                              <a:s>'Unsupported duration unit '</a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="82">
                              <a:s r="81">
                                 <a:s r="80">
                                    <a:s>value</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="81">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="82">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
    end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="85" locator="96:5-106:7" xsi:type="Case">
            <comparand localId="9" locator="96:10-96:25" path="value" xsi:type="Property">
               <source localId="8" locator="96:10-96:19" path="code" xsi:type="Property">
                  <source localId="7" locator="96:10-96:14" name="value" xsi:type="OperandRef"/>
               </source>
            </comparand>
            <caseItem localId="15" locator="97:7-97:39">
               <when localId="10" locator="97:12-97:14" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="14" locator="97:21-97:39" xsi:type="Multiply">
                  <operand name="ToDecimal" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="12" locator="97:21-97:31" path="value" xsi:type="Property">
                        <source localId="11" locator="97:21-97:25" name="value" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand localId="13" locator="97:35-97:39" valueType="t:Decimal" value="365.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="22" locator="98:7-98:45">
               <when localId="16" locator="98:12-98:15" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="21" locator="98:22-98:45" xsi:type="Multiply">
                  <operand localId="19" locator="98:22-98:38" path="value" xsi:type="Property">
                     <source localId="18" locator="98:22-98:32" path="value" xsi:type="Property">
                        <source localId="17" locator="98:22-98:26" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="20" locator="98:42-98:45" valueType="t:Decimal" value="30.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="29" locator="99:7-99:44">
               <when localId="23" locator="99:12-99:15" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="28" locator="99:22-99:44" xsi:type="Multiply">
                  <operand localId="26" locator="99:22-99:38" path="value" xsi:type="Property">
                     <source localId="25" locator="99:22-99:32" path="value" xsi:type="Property">
                        <source localId="24" locator="99:22-99:26" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="27" locator="99:42-99:44" valueType="t:Decimal" value="7.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="34" locator="100:7-100:37">
               <when localId="30" locator="100:12-100:14" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="33" locator="100:21-100:37" path="value" xsi:type="Property">
                  <source localId="32" locator="100:21-100:31" path="value" xsi:type="Property">
                     <source localId="31" locator="100:21-100:25" name="value" xsi:type="OperandRef"/>
                  </source>
               </then>
            </caseItem>
            <caseItem localId="41" locator="101:7-101:44">
               <when localId="35" locator="101:12-101:14" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="40" locator="101:21-101:44" xsi:type="Divide">
                  <operand localId="38" locator="101:21-101:37" path="value" xsi:type="Property">
                     <source localId="37" locator="101:21-101:31" path="value" xsi:type="Property">
                        <source localId="36" locator="101:21-101:25" name="value" xsi:type="OperandRef"/>
                     </source>
                  </operand>
                  <operand localId="39" locator="101:41-101:44" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="50" locator="102:7-102:53">
               <when localId="42" locator="102:12-102:16" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="49" locator="102:23-102:53" xsi:type="Divide">
                  <operand localId="47" locator="102:23-102:46" xsi:type="Divide">
                     <operand localId="45" locator="102:23-102:39" path="value" xsi:type="Property">
                        <source localId="44" locator="102:23-102:33" path="value" xsi:type="Property">
                           <source localId="43" locator="102:23-102:27" name="value" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                     <operand localId="46" locator="102:43-102:46" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="48" locator="102:50-102:53" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="61" locator="103:7-103:58">
               <when localId="51" locator="103:12-103:14" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="60" locator="103:21-103:58" xsi:type="Divide">
                  <operand localId="58" locator="103:21-103:51" xsi:type="Divide">
                     <operand localId="56" locator="103:21-103:44" xsi:type="Divide">
                        <operand localId="54" locator="103:21-103:37" path="value" xsi:type="Property">
                           <source localId="53" locator="103:21-103:31" path="value" xsi:type="Property">
                              <source localId="52" locator="103:21-103:25" name="value" xsi:type="OperandRef"/>
                           </source>
                        </operand>
                        <operand localId="55" locator="103:41-103:44" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="57" locator="103:48-103:51" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="59" locator="103:55-103:58" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="74" locator="104:7-104:68">
               <when localId="62" locator="104:12-104:15" valueType="t:String" value="ms" xsi:type="Literal"/>
               <then localId="73" locator="104:22-104:68" xsi:type="Divide">
                  <operand localId="71" locator="104:22-104:59" xsi:type="Divide">
                     <operand localId="69" locator="104:22-104:52" xsi:type="Divide">
                        <operand localId="67" locator="104:22-104:45" xsi:type="Divide">
                           <operand localId="65" locator="104:22-104:38" path="value" xsi:type="Property">
                              <source localId="64" locator="104:22-104:32" path="value" xsi:type="Property">
                                 <source localId="63" locator="104:22-104:26" name="value" xsi:type="OperandRef"/>
                              </source>
                           </operand>
                           <operand localId="66" locator="104:42-104:45" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                        </operand>
                        <operand localId="68" locator="104:49-104:52" valueType="t:Decimal" value="60.0" xsi:type="Literal"/>
                     </operand>
                     <operand localId="70" locator="104:56-104:59" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                  </operand>
                  <operand localId="72" locator="104:63-104:68" valueType="t:Decimal" value="1000.0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <else xsi:type="ToDecimal">
               <operand localId="84" locator="105:12-105:101" xsi:type="Message">
                  <source localId="75" locator="105:20-105:23" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                  <condition localId="76" locator="105:26-105:29" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="77" locator="105:32-105:42" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                  <severity localId="78" locator="105:45-105:51" valueType="t:String" value="Error" xsi:type="Literal"/>
                  <message localId="83" locator="105:54-105:100" xsi:type="Concatenate">
                     <operand localId="79" locator="105:54-105:81" valueType="t:String" value="Unsupported duration unit " xsi:type="Literal"/>
                     <operand localId="82" locator="105:85-105:100" path="value" xsi:type="Property">
                        <source localId="81" locator="105:85-105:94" path="code" xsi:type="Property">
                           <source localId="80" locator="105:85-105:89" name="value" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </message>
               </operand>
            </else>
         </expression>
         <operand name="value">
            <operandTypeSpecifier localId="6" locator="95:41-95:53" name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="116" locator="108:1-117:11" name="Prescription Relevant Period" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="116">
               <a:s>define function &quot;Prescription Relevant Period&quot;(prescription FHIR.MedicationRequest):
  </a:s>
               <a:s r="115">
                  <a:s r="115">
                     <a:s>if </a:s>
                     <a:s r="99">
                        <a:s>(
    </a:s>
                        <a:s r="99">
                           <a:s r="94">
                              <a:s r="90">
                                 <a:s r="89">
                                    <a:s r="88">
                                       <a:s>prescription</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="89">
                                       <a:s>authoredOn</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> is not null</a:s>
                              </a:s>
                              <a:s> and </a:s>
                              <a:s r="93">
                                 <a:s r="92">
                                    <a:s r="91">
                                       <a:s>prescription</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="92">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> is not null</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      and </a:s>
                           <a:s r="98">
                              <a:s r="97">
                                 <a:s r="96">
                                    <a:s r="95">
                                       <a:s>prescription</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="96">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="97">
                                    <a:s>expectedSupplyDuration</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is not null</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  )</a:s>
                     </a:s>
                     <a:s>
  then </a:s>
                     <a:s r="113">
                        <a:s>Interval[
    </a:s>
                        <a:s r="102">
                           <a:s>date from </a:s>
                           <a:s r="101">
                              <a:s r="100">
                                 <a:s>prescription</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="101">
                                 <a:s>authoredOn</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    </a:s>
                        <a:s r="112">
                           <a:s r="105">
                              <a:s>date from </a:s>
                              <a:s r="104">
                                 <a:s r="103">
                                    <a:s>prescription</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="104">
                                    <a:s>authoredOn</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="111">
                              <a:s>System.Quantity{ </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="109">
                                    <a:s>GetDurationInDays(</a:s>
                                    <a:s r="108">
                                       <a:s r="107">
                                          <a:s r="106">
                                             <a:s>prescription</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="107">
                                             <a:s>dispenseRequest</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="108">
                                          <a:s>expectedSupplyDuration</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="110">
                                    <a:s>'days'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  ]</a:s>
                     </a:s>
                     <a:s r="114">
  else null</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="115" locator="109:3-117:11" xsi:type="If">
            <condition localId="99" locator="109:6-112:3" xsi:type="And">
               <operand localId="94" locator="110:5-110:84" xsi:type="And">
                  <operand localId="90" locator="110:5-110:39" xsi:type="Not">
                     <operand locator="110:5-110:39" xsi:type="IsNull">
                        <operand localId="89" locator="110:5-110:27" path="authoredOn" xsi:type="Property">
                           <source localId="88" locator="110:5-110:16" name="prescription" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="93" locator="110:45-110:84" xsi:type="Not">
                     <operand locator="110:45-110:84" xsi:type="IsNull">
                        <operand localId="92" locator="110:45-110:72" path="dispenseRequest" xsi:type="Property">
                           <source localId="91" locator="110:45-110:56" name="prescription" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </operand>
               <operand localId="98" locator="111:11-111:73" xsi:type="Not">
                  <operand locator="111:11-111:73" xsi:type="IsNull">
                     <operand localId="97" locator="111:11-111:61" path="expectedSupplyDuration" xsi:type="Property">
                        <source localId="96" locator="111:11-111:38" path="dispenseRequest" xsi:type="Property">
                           <source localId="95" locator="111:11-111:22" name="prescription" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </operand>
            </condition>
            <then localId="113" locator="113:8-116:3" lowClosed="true" highClosed="true" xsi:type="Interval">
               <low localId="102" locator="114:5-114:37" xsi:type="DateFrom">
                  <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="101" locator="114:15-114:37" path="authoredOn" xsi:type="Property">
                        <source localId="100" locator="114:15-114:26" name="prescription" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </low>
               <high localId="112" locator="115:5-115:150" xsi:type="Add">
                  <operand localId="105" locator="115:5-115:37" xsi:type="DateFrom">
                     <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="104" locator="115:15-115:37" path="authoredOn" xsi:type="Property">
                           <source localId="103" locator="115:15-115:26" name="prescription" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="111" locator="115:41-115:150" classType="t:Quantity" xsi:type="Instance">
                     <element name="value">
                        <value localId="109" locator="115:65-115:134" name="GetDurationInDays" xsi:type="FunctionRef">
                           <operand localId="108" locator="115:83-115:133" path="expectedSupplyDuration" xsi:type="Property">
                              <source localId="107" locator="115:83-115:110" path="dispenseRequest" xsi:type="Property">
                                 <source localId="106" locator="115:83-115:94" name="prescription" xsi:type="OperandRef"/>
                              </source>
                           </operand>
                        </value>
                     </element>
                     <element name="unit">
                        <value localId="110" locator="115:143-115:148" valueType="t:String" value="days" xsi:type="Literal"/>
                     </element>
                  </operand>
               </high>
            </then>
            <else xsi:type="As">
               <operand localId="114" locator="117:8-117:11" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:Date" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </else>
         </expression>
         <operand name="prescription">
            <operandTypeSpecifier localId="87" locator="108:61-108:82" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="351" locator="120:1-144:5" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="351">
               <a:s>//System.Integer
define function ToDaily(frequency System.Integer, period System.Quantity):
  </a:s>
               <a:s r="350">
                  <a:s r="350">
                     <a:s>case </a:s>
                     <a:s r="120">
                        <a:s r="119">
                           <a:s>period</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="120">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="128">
                        <a:s>when </a:s>
                        <a:s r="121">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="127">
                           <a:s r="122">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="126">
                              <a:s>(</a:s>
                              <a:s r="126">
                                 <a:s r="123">24.0 / </a:s>
                                 <a:s r="125">
                                    <a:s r="124">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="125">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="138">
                        <a:s>when </a:s>
                        <a:s r="129">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="137">
                           <a:s r="135">
                              <a:s r="130">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="134">
                                 <a:s>(</a:s>
                                 <a:s r="134">
                                    <a:s r="131">24.0 / </a:s>
                                    <a:s r="133">
                                       <a:s r="132">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="133">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="136"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="150">
                        <a:s>when </a:s>
                        <a:s r="139">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="149">
                           <a:s r="147">
                              <a:s r="145">
                                 <a:s r="140">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="144">
                                    <a:s>(</a:s>
                                    <a:s r="144">
                                       <a:s r="141">24.0 / </a:s>
                                       <a:s r="143">
                                          <a:s r="142">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="143">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="146"> * 60</a:s>
                           </a:s>
                           <a:s r="148"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="160">
                        <a:s>when </a:s>
                        <a:s r="151">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="159">
                           <a:s r="157">
                              <a:s r="152">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="156">
                                 <a:s>(</a:s>
                                 <a:s r="156">
                                    <a:s r="153">24.0 / </a:s>
                                    <a:s r="155">
                                       <a:s r="154">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="155">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="158"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="172">
                        <a:s>when </a:s>
                        <a:s r="161">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="171">
                           <a:s r="167">
                              <a:s r="162">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="166">
                                 <a:s>(</a:s>
                                 <a:s r="166">
                                    <a:s r="163">24.0 / </a:s>
                                    <a:s r="165">
                                       <a:s r="164">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="165">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="170">
                              <a:s>(</a:s>
                              <a:s r="170">
                                 <a:s r="168">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="184">
                        <a:s>when </a:s>
                        <a:s r="173">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="183">
                           <a:s r="179">
                              <a:s r="174">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="178">
                                 <a:s>(</a:s>
                                 <a:s r="178">
                                    <a:s r="175">24.0 / </a:s>
                                    <a:s r="177">
                                       <a:s r="176">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="177">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="182">
                              <a:s>(</a:s>
                              <a:s r="182">
                                 <a:s r="180">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="196">
                        <a:s>when </a:s>
                        <a:s r="185">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="195">
                           <a:s r="191">
                              <a:s r="186">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="190">
                                 <a:s>(</a:s>
                                 <a:s r="190">
                                    <a:s r="187">24.0 / </a:s>
                                    <a:s r="189">
                                       <a:s r="188">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="189">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="194">
                              <a:s>(</a:s>
                              <a:s r="194">
                                 <a:s r="192">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="204">
                        <a:s>when </a:s>
                        <a:s r="197">
                           <a:s>'hour'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="203">
                           <a:s r="198">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="202">
                              <a:s>(</a:s>
                              <a:s r="202">
                                 <a:s r="199">24.0 / </a:s>
                                 <a:s r="201">
                                    <a:s r="200">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="201">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="214">
                        <a:s>when </a:s>
                        <a:s r="205">
                           <a:s>'minute'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="213">
                           <a:s r="211">
                              <a:s r="206">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="210">
                                 <a:s>(</a:s>
                                 <a:s r="210">
                                    <a:s r="207">24.0 / </a:s>
                                    <a:s r="209">
                                       <a:s r="208">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="209">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="212"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="226">
                        <a:s>when </a:s>
                        <a:s r="215">
                           <a:s>'second'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="225">
                           <a:s r="223">
                              <a:s r="221">
                                 <a:s r="216">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="220">
                                    <a:s>(</a:s>
                                    <a:s r="220">
                                       <a:s r="217">24.0 / </a:s>
                                       <a:s r="219">
                                          <a:s r="218">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="219">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="222"> * 60</a:s>
                           </a:s>
                           <a:s r="224"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="236">
                        <a:s>when </a:s>
                        <a:s r="227">
                           <a:s>'day'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="235">
                           <a:s r="233">
                              <a:s r="228">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="232">
                                 <a:s>(</a:s>
                                 <a:s r="232">
                                    <a:s r="229">24.0 / </a:s>
                                    <a:s r="231">
                                       <a:s r="230">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="231">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="234"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="248">
                        <a:s>when </a:s>
                        <a:s r="237">
                           <a:s>'week'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="247">
                           <a:s r="243">
                              <a:s r="238">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="242">
                                 <a:s>(</a:s>
                                 <a:s r="242">
                                    <a:s r="239">24.0 / </a:s>
                                    <a:s r="241">
                                       <a:s r="240">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="241">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="246">
                              <a:s>(</a:s>
                              <a:s r="246">
                                 <a:s r="244">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="260">
                        <a:s>when </a:s>
                        <a:s r="249">
                           <a:s>'month'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="259">
                           <a:s r="255">
                              <a:s r="250">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="254">
                                 <a:s>(</a:s>
                                 <a:s r="254">
                                    <a:s r="251">24.0 / </a:s>
                                    <a:s r="253">
                                       <a:s r="252">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="253">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="258">
                              <a:s>(</a:s>
                              <a:s r="258">
                                 <a:s r="256">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="272">
                        <a:s>when </a:s>
                        <a:s r="261">
                           <a:s>'year'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="271">
                           <a:s r="267">
                              <a:s r="262">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="266">
                                 <a:s>(</a:s>
                                 <a:s r="266">
                                    <a:s r="263">24.0 / </a:s>
                                    <a:s r="265">
                                       <a:s r="264">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="265">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="270">
                              <a:s>(</a:s>
                              <a:s r="270">
                                 <a:s r="268">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="280">
                        <a:s>when </a:s>
                        <a:s r="273">
                           <a:s>'hours'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="279">
                           <a:s r="274">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="278">
                              <a:s>(</a:s>
                              <a:s r="278">
                                 <a:s r="275">24.0 / </a:s>
                                 <a:s r="277">
                                    <a:s r="276">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="277">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="290">
                        <a:s>when </a:s>
                        <a:s r="281">
                           <a:s>'minutes'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="289">
                           <a:s r="287">
                              <a:s r="282">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="286">
                                 <a:s>(</a:s>
                                 <a:s r="286">
                                    <a:s r="283">24.0 / </a:s>
                                    <a:s r="285">
                                       <a:s r="284">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="285">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="288"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="302">
                        <a:s>when </a:s>
                        <a:s r="291">
                           <a:s>'seconds'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="301">
                           <a:s r="299">
                              <a:s r="297">
                                 <a:s r="292">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="296">
                                    <a:s>(</a:s>
                                    <a:s r="296">
                                       <a:s r="293">24.0 / </a:s>
                                       <a:s r="295">
                                          <a:s r="294">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="295">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="298"> * 60</a:s>
                           </a:s>
                           <a:s r="300"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="312">
                        <a:s>when </a:s>
                        <a:s r="303">
                           <a:s>'days'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="311">
                           <a:s r="309">
                              <a:s r="304">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="308">
                                 <a:s>(</a:s>
                                 <a:s r="308">
                                    <a:s r="305">24.0 / </a:s>
                                    <a:s r="307">
                                       <a:s r="306">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="307">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="310"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="324">
                        <a:s>when </a:s>
                        <a:s r="313">
                           <a:s>'weeks'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="323">
                           <a:s r="319">
                              <a:s r="314">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="318">
                                 <a:s>(</a:s>
                                 <a:s r="318">
                                    <a:s r="315">24.0 / </a:s>
                                    <a:s r="317">
                                       <a:s r="316">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="317">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="322">
                              <a:s>(</a:s>
                              <a:s r="322">
                                 <a:s r="320">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="336">
                        <a:s>when </a:s>
                        <a:s r="325">
                           <a:s>'months'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="335">
                           <a:s r="331">
                              <a:s r="326">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="330">
                                 <a:s>(</a:s>
                                 <a:s r="330">
                                    <a:s r="327">24.0 / </a:s>
                                    <a:s r="329">
                                       <a:s r="328">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="329">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="334">
                              <a:s>(</a:s>
                              <a:s r="334">
                                 <a:s r="332">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="348">
                        <a:s>when </a:s>
                        <a:s r="337">
                           <a:s>'years'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="347">
                           <a:s r="343">
                              <a:s r="338">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="342">
                                 <a:s>(</a:s>
                                 <a:s r="342">
                                    <a:s r="339">24.0 / </a:s>
                                    <a:s r="341">
                                       <a:s r="340">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="341">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="346">
                              <a:s>(</a:s>
                              <a:s r="346">
                                 <a:s r="344">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s r="349"> /* assuming 365 days in year */
    else null
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="350" locator="121:3-144:5" xsi:type="Case">
            <comparand localId="120" locator="121:8-121:18" path="unit" xsi:type="Property">
               <source localId="119" locator="121:8-121:13" name="period" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="128" locator="122:5-122:51">
               <when localId="121" locator="122:10-122:12" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="127" locator="122:19-122:51" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="122" locator="122:19-122:27" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="126" locator="122:31-122:51" xsi:type="Divide">
                     <operand localId="123" locator="122:32-122:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="125" locator="122:39-122:50" path="value" xsi:type="Property">
                        <source localId="124" locator="122:39-122:44" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="138" locator="123:5-123:58">
               <when localId="129" locator="123:10-123:14" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="137" locator="123:21-123:58" xsi:type="Multiply">
                  <operand localId="135" locator="123:21-123:53" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="130" locator="123:21-123:29" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="134" locator="123:33-123:53" xsi:type="Divide">
                        <operand localId="131" locator="123:34-123:37" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="133" locator="123:41-123:52" path="value" xsi:type="Property">
                           <source localId="132" locator="123:41-123:46" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="136" locator="123:57-123:58" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="150" locator="124:5-124:61">
               <when localId="139" locator="124:10-124:12" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="149" locator="124:19-124:61" xsi:type="Multiply">
                  <operand localId="147" locator="124:19-124:56" xsi:type="Multiply">
                     <operand localId="145" locator="124:19-124:51" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="140" locator="124:19-124:27" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="144" locator="124:31-124:51" xsi:type="Divide">
                           <operand localId="141" locator="124:32-124:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="143" locator="124:39-124:50" path="value" xsi:type="Property">
                              <source localId="142" locator="124:39-124:44" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="146" locator="124:55-124:56" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="148" locator="124:60-124:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="160" locator="125:5-125:56">
               <when localId="151" locator="125:10-125:12" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="159" locator="125:19-125:56" xsi:type="Divide">
                  <operand localId="157" locator="125:19-125:51" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="152" locator="125:19-125:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="156" locator="125:31-125:51" xsi:type="Divide">
                        <operand localId="153" locator="125:32-125:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="155" locator="125:39-125:50" path="value" xsi:type="Property">
                           <source localId="154" locator="125:39-125:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="158" locator="125:55-125:56" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="172" locator="126:5-126:63">
               <when localId="161" locator="126:10-126:13" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="171" locator="126:20-126:63" xsi:type="Divide">
                  <operand localId="167" locator="126:20-126:52" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="162" locator="126:20-126:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="166" locator="126:32-126:52" xsi:type="Divide">
                        <operand localId="163" locator="126:33-126:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="165" locator="126:40-126:51" path="value" xsi:type="Property">
                           <source localId="164" locator="126:40-126:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="170" locator="126:56-126:63" xsi:type="Multiply">
                        <operand localId="168" locator="126:57-126:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="169" locator="126:62" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="184" locator="127:5-127:64">
               <when localId="173" locator="127:10-127:13" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="183" locator="127:20-127:64" xsi:type="Divide">
                  <operand localId="179" locator="127:20-127:52" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="174" locator="127:20-127:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="178" locator="127:32-127:52" xsi:type="Divide">
                        <operand localId="175" locator="127:33-127:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="177" locator="127:40-127:51" path="value" xsi:type="Property">
                           <source localId="176" locator="127:40-127:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="182" locator="127:56-127:64" xsi:type="Multiply">
                        <operand localId="180" locator="127:57-127:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="181" locator="127:62-127:63" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="196" locator="128:5-128:64">
               <when localId="185" locator="128:10-128:12" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="195" locator="128:19-128:64" xsi:type="Divide">
                  <operand localId="191" locator="128:19-128:51" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="186" locator="128:19-128:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="190" locator="128:31-128:51" xsi:type="Divide">
                        <operand localId="187" locator="128:32-128:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="189" locator="128:39-128:50" path="value" xsi:type="Property">
                           <source localId="188" locator="128:39-128:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="194" locator="128:55-128:64" xsi:type="Multiply">
                        <operand localId="192" locator="128:56-128:57" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="193" locator="128:61-128:63" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="204" locator="129:5-129:54">
               <when localId="197" locator="129:10-129:15" valueType="t:String" value="hour" xsi:type="Literal"/>
               <then localId="203" locator="129:22-129:54" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="198" locator="129:22-129:30" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="202" locator="129:34-129:54" xsi:type="Divide">
                     <operand localId="199" locator="129:35-129:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="201" locator="129:42-129:53" path="value" xsi:type="Property">
                        <source localId="200" locator="129:42-129:47" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="214" locator="130:5-130:61">
               <when localId="205" locator="130:10-130:17" valueType="t:String" value="minute" xsi:type="Literal"/>
               <then localId="213" locator="130:24-130:61" xsi:type="Multiply">
                  <operand localId="211" locator="130:24-130:56" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="206" locator="130:24-130:32" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="210" locator="130:36-130:56" xsi:type="Divide">
                        <operand localId="207" locator="130:37-130:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="209" locator="130:44-130:55" path="value" xsi:type="Property">
                           <source localId="208" locator="130:44-130:49" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="212" locator="130:60-130:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="226" locator="131:5-131:66">
               <when localId="215" locator="131:10-131:17" valueType="t:String" value="second" xsi:type="Literal"/>
               <then localId="225" locator="131:24-131:66" xsi:type="Multiply">
                  <operand localId="223" locator="131:24-131:61" xsi:type="Multiply">
                     <operand localId="221" locator="131:24-131:56" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="216" locator="131:24-131:32" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="220" locator="131:36-131:56" xsi:type="Divide">
                           <operand localId="217" locator="131:37-131:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="219" locator="131:44-131:55" path="value" xsi:type="Property">
                              <source localId="218" locator="131:44-131:49" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="222" locator="131:60-131:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="224" locator="131:65-131:66" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="236" locator="132:5-132:58">
               <when localId="227" locator="132:10-132:14" valueType="t:String" value="day" xsi:type="Literal"/>
               <then localId="235" locator="132:21-132:58" xsi:type="Divide">
                  <operand localId="233" locator="132:21-132:53" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="228" locator="132:21-132:29" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="232" locator="132:33-132:53" xsi:type="Divide">
                        <operand localId="229" locator="132:34-132:37" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="231" locator="132:41-132:52" path="value" xsi:type="Property">
                           <source localId="230" locator="132:41-132:46" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="234" locator="132:57-132:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="248" locator="133:5-133:65">
               <when localId="237" locator="133:10-133:15" valueType="t:String" value="week" xsi:type="Literal"/>
               <then localId="247" locator="133:22-133:65" xsi:type="Divide">
                  <operand localId="243" locator="133:22-133:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="238" locator="133:22-133:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="242" locator="133:34-133:54" xsi:type="Divide">
                        <operand localId="239" locator="133:35-133:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="241" locator="133:42-133:53" path="value" xsi:type="Property">
                           <source localId="240" locator="133:42-133:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="246" locator="133:58-133:65" xsi:type="Multiply">
                        <operand localId="244" locator="133:59-133:60" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="245" locator="133:64" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="260" locator="134:5-134:67">
               <when localId="249" locator="134:10-134:16" valueType="t:String" value="month" xsi:type="Literal"/>
               <then localId="259" locator="134:23-134:67" xsi:type="Divide">
                  <operand localId="255" locator="134:23-134:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="250" locator="134:23-134:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="254" locator="134:35-134:55" xsi:type="Divide">
                        <operand localId="251" locator="134:36-134:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="253" locator="134:43-134:54" path="value" xsi:type="Property">
                           <source localId="252" locator="134:43-134:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="258" locator="134:59-134:67" xsi:type="Multiply">
                        <operand localId="256" locator="134:60-134:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="257" locator="134:65-134:66" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="272" locator="135:5-135:67">
               <when localId="261" locator="135:10-135:15" valueType="t:String" value="year" xsi:type="Literal"/>
               <then localId="271" locator="135:22-135:67" xsi:type="Divide">
                  <operand localId="267" locator="135:22-135:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="262" locator="135:22-135:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="266" locator="135:34-135:54" xsi:type="Divide">
                        <operand localId="263" locator="135:35-135:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="265" locator="135:42-135:53" path="value" xsi:type="Property">
                           <source localId="264" locator="135:42-135:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="270" locator="135:58-135:67" xsi:type="Multiply">
                        <operand localId="268" locator="135:59-135:60" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="269" locator="135:64-135:66" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="280" locator="136:5-136:55">
               <when localId="273" locator="136:10-136:16" valueType="t:String" value="hours" xsi:type="Literal"/>
               <then localId="279" locator="136:23-136:55" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="274" locator="136:23-136:31" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="278" locator="136:35-136:55" xsi:type="Divide">
                     <operand localId="275" locator="136:36-136:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="277" locator="136:43-136:54" path="value" xsi:type="Property">
                        <source localId="276" locator="136:43-136:48" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="290" locator="137:5-137:62">
               <when localId="281" locator="137:10-137:18" valueType="t:String" value="minutes" xsi:type="Literal"/>
               <then localId="289" locator="137:25-137:62" xsi:type="Multiply">
                  <operand localId="287" locator="137:25-137:57" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="282" locator="137:25-137:33" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="286" locator="137:37-137:57" xsi:type="Divide">
                        <operand localId="283" locator="137:38-137:41" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="285" locator="137:45-137:56" path="value" xsi:type="Property">
                           <source localId="284" locator="137:45-137:50" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="288" locator="137:61-137:62" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="302" locator="138:5-138:67">
               <when localId="291" locator="138:10-138:18" valueType="t:String" value="seconds" xsi:type="Literal"/>
               <then localId="301" locator="138:25-138:67" xsi:type="Multiply">
                  <operand localId="299" locator="138:25-138:62" xsi:type="Multiply">
                     <operand localId="297" locator="138:25-138:57" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="292" locator="138:25-138:33" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="296" locator="138:37-138:57" xsi:type="Divide">
                           <operand localId="293" locator="138:38-138:41" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="295" locator="138:45-138:56" path="value" xsi:type="Property">
                              <source localId="294" locator="138:45-138:50" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="298" locator="138:61-138:62" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="300" locator="138:66-138:67" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="312" locator="139:5-139:59">
               <when localId="303" locator="139:10-139:15" valueType="t:String" value="days" xsi:type="Literal"/>
               <then localId="311" locator="139:22-139:59" xsi:type="Divide">
                  <operand localId="309" locator="139:22-139:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="304" locator="139:22-139:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="308" locator="139:34-139:54" xsi:type="Divide">
                        <operand localId="305" locator="139:35-139:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="307" locator="139:42-139:53" path="value" xsi:type="Property">
                           <source localId="306" locator="139:42-139:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="310" locator="139:58-139:59" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="324" locator="140:5-140:66">
               <when localId="313" locator="140:10-140:16" valueType="t:String" value="weeks" xsi:type="Literal"/>
               <then localId="323" locator="140:23-140:66" xsi:type="Divide">
                  <operand localId="319" locator="140:23-140:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="314" locator="140:23-140:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="318" locator="140:35-140:55" xsi:type="Divide">
                        <operand localId="315" locator="140:36-140:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="317" locator="140:43-140:54" path="value" xsi:type="Property">
                           <source localId="316" locator="140:43-140:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="322" locator="140:59-140:66" xsi:type="Multiply">
                        <operand localId="320" locator="140:60-140:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="321" locator="140:65" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="336" locator="141:5-141:68">
               <when localId="325" locator="141:10-141:17" valueType="t:String" value="months" xsi:type="Literal"/>
               <then localId="335" locator="141:24-141:68" xsi:type="Divide">
                  <operand localId="331" locator="141:24-141:56" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="326" locator="141:24-141:32" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="330" locator="141:36-141:56" xsi:type="Divide">
                        <operand localId="327" locator="141:37-141:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="329" locator="141:44-141:55" path="value" xsi:type="Property">
                           <source localId="328" locator="141:44-141:49" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="334" locator="141:60-141:68" xsi:type="Multiply">
                        <operand localId="332" locator="141:61-141:62" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="333" locator="141:66-141:67" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="348" locator="142:5-142:68">
               <when localId="337" locator="142:10-142:16" valueType="t:String" value="years" xsi:type="Literal"/>
               <then localId="347" locator="142:23-142:68" xsi:type="Divide">
                  <operand localId="343" locator="142:23-142:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="338" locator="142:23-142:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="342" locator="142:35-142:55" xsi:type="Divide">
                        <operand localId="339" locator="142:36-142:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="341" locator="142:43-142:54" path="value" xsi:type="Property">
                           <source localId="340" locator="142:43-142:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="346" locator="142:59-142:68" xsi:type="Multiply">
                        <operand localId="344" locator="142:60-142:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="345" locator="142:65-142:67" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="349" locator="143:10-143:13" xsi:type="Null"/>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="117" locator="120:35-120:48" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="period">
            <operandTypeSpecifier localId="118" locator="120:58-120:72" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="364" locator="146:3-149:1" name="HasEnd" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="364">
               <a:s>define function &quot;HasEnd&quot;(period Interval&lt;DateTime> ):
  </a:s>
               <a:s r="363">
                  <a:s r="363">
                     <a:s>not </a:s>
                     <a:s r="362">
                        <a:s>(</a:s>
                        <a:s r="362">
                           <a:s r="356">
                              <a:s r="355">
                                 <a:s>end of </a:s>
                                 <a:s r="354">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s>
    or </a:s>
                           <a:s r="361">
                              <a:s r="358">
                                 <a:s>end of </a:s>
                                 <a:s r="357">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="360">
                                 <a:s>maximum </a:s>
                                 <a:s r="359">
                                    <a:s>DateTime</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="363" locator="147:3-149:1" xsi:type="Not">
            <operand localId="362" locator="147:7-149:1" xsi:type="Or">
               <operand localId="356" locator="147:8-147:28" xsi:type="IsNull">
                  <operand localId="355" locator="147:8-147:20" xsi:type="End">
                     <operand localId="354" locator="147:15-147:20" name="period" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <operand localId="361" locator="148:8-148:39" xsi:type="Equal">
                  <operand localId="358" locator="148:8-148:20" xsi:type="End">
                     <operand localId="357" locator="148:15-148:20" name="period" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="360" locator="148:24-148:39" valueType="t:DateTime" xsi:type="MaxValue"/>
               </operand>
            </operand>
         </expression>
         <operand name="period">
            <operandTypeSpecifier localId="353" locator="146:35-146:52" xsi:type="IntervalTypeSpecifier">
               <pointType localId="352" locator="146:44-146:51" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="481" locator="151:3-181:64" name="MedicationRequestPeriod" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="481">
               <a:s>define function MedicationRequestPeriod(Request FHIR.MedicationRequest):
  </a:s>
               <a:s r="480">
                  <a:s r="480">
                     <a:s>
                        <a:s r="367">
                           <a:s r="366">
                              <a:s>
                                 <a:s>Request</a:s>
                              </a:s>
                           </a:s>
                           <a:s> R</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let
      </a:s>
                        <a:s r="371">
                           <a:s>dosage: </a:s>
                           <a:s r="370">
                              <a:s>singleton from </a:s>
                              <a:s r="369">
                                 <a:s r="368">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="369">
                                    <a:s>dosageInstruction</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="375">
                           <a:s>doseAndRate: </a:s>
                           <a:s r="374">
                              <a:s>singleton from </a:s>
                              <a:s r="373">
                                 <a:s r="372">
                                    <a:s>dosage</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="373">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="380">
                           <a:s>doseRange: </a:s>
                           <a:s r="379">
                              <a:s r="377">
                                 <a:s r="376">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="377">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="378">
                                 <a:s>Range</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="385">
                           <a:s>doseQuantity: </a:s>
                           <a:s r="384">
                              <a:s r="382">
                                 <a:s r="381">
                                    <a:s>doseAndRate</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="382">
                                    <a:s>dose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="383">
                                 <a:s>SimpleQuantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="390">
                           <a:s>dose: </a:s>
                           <a:s r="389">
                              <a:s>Coalesce(</a:s>
                              <a:s r="387">
                                 <a:s>end of </a:s>
                                 <a:s r="386">
                                    <a:s>doseRange</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="388">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="393">
                           <a:s>timing: </a:s>
                           <a:s r="392">
                              <a:s r="391">
                                 <a:s>dosage</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="392">
                                 <a:s>timing</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="401">
                           <a:s>frequency: </a:s>
                           <a:s r="400">
                              <a:s>Coalesce(</a:s>
                              <a:s r="396">
                                 <a:s r="395">
                                    <a:s r="394">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="395">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="396">
                                    <a:s>frequencyMax</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="399">
                                 <a:s r="398">
                                    <a:s r="397">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="398">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="399">
                                    <a:s>frequency</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="410">
                           <a:s>period: </a:s>
                           <a:s r="409">
                              <a:s>System.Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="404">
                                    <a:s r="403">
                                       <a:s r="402">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="403">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="404">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="408">
                                    <a:s r="407">
                                       <a:s r="406">
                                          <a:s r="405">
                                             <a:s>timing</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="406">
                                             <a:s>repeat</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="407">
                                          <a:s>periodUnit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="408">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="422">
                           <a:s>dosesPerDay: </a:s>
                           <a:s r="421">
                              <a:s>Coalesce(</a:s>
                              <a:s r="415">
                                 <a:s>ToDaily(</a:s>
                                 <a:s r="413">
                                    <a:s r="411">
                                       <a:s>FHIRHelpers</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="413">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="412">
                                          <a:s>frequency</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="414">
                                    <a:s>period</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="419">
                                 <a:s>Count(</a:s>
                                 <a:s r="418">
                                    <a:s r="417">
                                       <a:s r="416">
                                          <a:s>timing</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="417">
                                          <a:s>repeat</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="418">
                                       <a:s>timeOfDay</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="420">, 1.0)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="428">
                           <a:s>boundsPeriod: </a:s>
                           <a:s r="427">
                              <a:s r="425">
                                 <a:s r="424">
                                    <a:s r="423">
                                       <a:s>timing</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="424">
                                       <a:s>repeat</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="425">
                                    <a:s>bounds</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> as </a:s>
                              <a:s r="426">
                                 <a:s>Period</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="432">
                           <a:s>daysSupply: </a:s>
                           <a:s r="431">
                              <a:s r="430">
                                 <a:s r="429">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="430">
                                    <a:s>dispenseRequest</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="431">
                                 <a:s>expectedSupplyDuration</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="436">
                           <a:s>quantity: </a:s>
                           <a:s r="435">
                              <a:s r="434">
                                 <a:s r="433">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="434">
                                    <a:s>dispenseRequest</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="435">
                                 <a:s>quantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="442">
                           <a:s>refills: </a:s>
                           <a:s r="441">
                              <a:s>Coalesce(</a:s>
                              <a:s r="439">
                                 <a:s r="438">
                                    <a:s r="437">
                                       <a:s>R</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="438">
                                       <a:s>dispenseRequest</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="439">
                                    <a:s>numberOfRepeatsAllowed</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="440">, 0)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="452">
                           <a:s>startDate:
        </a:s>
                           <a:s r="451">
                              <a:s>Coalesce(
          </a:s>
                              <a:s r="444">
                                 <a:s>start of </a:s>
                                 <a:s r="443">
                                    <a:s>boundsPeriod</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s r="448">
                                 <a:s>start of </a:s>
                                 <a:s r="447">
                                    <a:s r="446">
                                       <a:s r="445">
                                          <a:s>R</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="446">
                                          <a:s>dispenseRequest</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="447">
                                       <a:s>validityPeriod</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s r="450">
                                 <a:s r="449">
                                    <a:s>R</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="450">
                                    <a:s>authoredOn</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        )</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="479">
                        <a:s>return
      </a:s>
                        <a:s r="478">
                           <a:s>if </a:s>
                           <a:s r="454">
                              <a:s>HasEnd(</a:s>
                              <a:s r="453">
                                 <a:s>boundsPeriod</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="458">
                              <a:s>Interval[</a:s>
                              <a:s r="455">
                                 <a:s>startDate</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="457">
                                 <a:s>end of </a:s>
                                 <a:s r="456">
                                    <a:s>boundsPeriod</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                           <a:s>
      else
        </a:s>
                           <a:s r="477">
                              <a:s>
                                 <a:s r="470">
                                    <a:s r="469">
                                       <a:s>(
          </a:s>
                                       <a:s r="469">
                                          <a:s r="465">
                                             <a:s>Coalesce(</a:s>
                                             <a:s r="459">
                                                <a:s>daysSupply</a:s>
                                             </a:s>
                                             <a:s>, </a:s>
                                             <a:s r="464">
                                                <a:s r="460">
                                                   <a:s>quantity</a:s>
                                                </a:s>
                                                <a:s> / </a:s>
                                                <a:s r="463">
                                                   <a:s>(</a:s>
                                                   <a:s r="463">
                                                      <a:s r="461">
                                                         <a:s>dose</a:s>
                                                      </a:s>
                                                      <a:s> * </a:s>
                                                      <a:s r="462">
                                                         <a:s>dosesPerDay</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s>
            * </a:s>
                                          <a:s r="468">
                                             <a:s>(</a:s>
                                             <a:s r="468">
                                                <a:s r="466">1 + </a:s>
                                                <a:s r="467">
                                                   <a:s>refills</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
        )</a:s>
                                    </a:s>
                                    <a:s> durationInDays</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s r="476">
                                 <a:s>return </a:s>
                                 <a:s r="475">
                                    <a:s>Interval[</a:s>
                                    <a:s r="471">
                                       <a:s>startDate</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="474">
                                       <a:s r="472">
                                          <a:s>startDate</a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="473">
                                          <a:s>durationInDays</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>]</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="480" locator="152:3-181:64" xsi:type="Query">
            <source localId="367" locator="152:3-152:11" alias="R">
               <expression localId="366" locator="152:3-152:9" name="Request" xsi:type="OperandRef"/>
            </source>
            <let localId="371" locator="154:7-154:48" identifier="dosage">
               <expression localId="370" locator="154:15-154:48" xsi:type="SingletonFrom">
                  <operand localId="369" locator="154:30-154:48" path="dosageInstruction" scope="R" xsi:type="Property"/>
               </expression>
            </let>
            <let localId="375" locator="155:7-155:52" identifier="doseAndRate">
               <expression localId="374" locator="155:20-155:52" xsi:type="SingletonFrom">
                  <operand localId="373" locator="155:35-155:52" path="doseAndRate" xsi:type="Property">
                     <source localId="372" locator="155:35-155:40" name="dosage" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="380" locator="156:7-156:42" identifier="doseRange">
               <expression localId="379" locator="156:18-156:42" strict="false" xsi:type="As">
                  <operand localId="377" locator="156:18-156:33" path="dose" xsi:type="Property">
                     <source localId="376" locator="156:18-156:28" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="378" locator="156:38-156:42" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="385" locator="157:7-157:54" identifier="doseQuantity">
               <expression localId="384" locator="157:21-157:54" strict="false" xsi:type="As">
                  <operand localId="382" locator="157:21-157:36" path="dose" xsi:type="Property">
                     <source localId="381" locator="157:21-157:31" name="doseAndRate" xsi:type="QueryLetRef"/>
                  </operand>
                  <asTypeSpecifier localId="383" locator="157:41-157:54" name="fhir:SimpleQuantity" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="390" locator="158:7-158:52" identifier="dose">
               <expression localId="389" locator="158:13-158:52" xsi:type="Coalesce">
                  <operand localId="387" locator="158:22-158:37" xsi:type="End">
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="386" locator="158:29-158:37" name="doseRange" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="388" locator="158:40-158:51" name="doseQuantity" xsi:type="QueryLetRef"/>
                  </operand>
               </expression>
            </let>
            <let localId="393" locator="159:7-159:27" identifier="timing">
               <expression localId="392" locator="159:15-159:27" path="timing" xsi:type="Property">
                  <source localId="391" locator="159:15-159:20" name="dosage" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="401" locator="160:7-160:78" identifier="frequency">
               <expression localId="400" locator="160:18-160:78" xsi:type="Coalesce">
                  <operand localId="396" locator="160:27-160:52" path="frequencyMax" xsi:type="Property">
                     <source localId="395" locator="160:27-160:39" path="repeat" xsi:type="Property">
                        <source localId="394" locator="160:27-160:32" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <operand localId="399" locator="160:55-160:77" path="frequency" xsi:type="Property">
                     <source localId="398" locator="160:55-160:67" path="repeat" xsi:type="Property">
                        <source localId="397" locator="160:55-160:60" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
               </expression>
            </let>
            <let localId="410" locator="161:7-161:99" identifier="period">
               <expression localId="409" locator="161:15-161:99" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value name="ToDecimal" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="404" locator="161:40-161:59" path="period" xsi:type="Property">
                           <source localId="403" locator="161:40-161:52" path="repeat" xsi:type="Property">
                              <source localId="402" locator="161:40-161:45" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="408" locator="161:68-161:97" path="value" xsi:type="Property">
                        <source localId="407" locator="161:68-161:91" path="periodUnit" xsi:type="Property">
                           <source localId="406" locator="161:68-161:80" path="repeat" xsi:type="Property">
                              <source localId="405" locator="161:68-161:73" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </value>
                  </element>
               </expression>
            </let>
            <let localId="422" locator="162:7-162:115" identifier="dosesPerDay">
               <expression localId="421" locator="162:20-162:115" xsi:type="Coalesce">
                  <operand localId="415" locator="162:29-162:77" name="ToDaily" xsi:type="FunctionRef">
                     <operand localId="413" locator="162:37-162:68" name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="412" locator="162:59-162:67" name="frequency" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand localId="414" locator="162:71-162:76" name="period" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="419" locator="162:80-162:109" xsi:type="Count">
                        <source localId="418" locator="162:86-162:108" path="timeOfDay" xsi:type="Property">
                           <source localId="417" locator="162:86-162:98" path="repeat" xsi:type="Property">
                              <source localId="416" locator="162:86-162:91" name="timing" xsi:type="QueryLetRef"/>
                           </source>
                        </source>
                     </operand>
                  </operand>
                  <operand localId="420" locator="162:112-162:114" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="428" locator="163:7-163:50" identifier="boundsPeriod">
               <expression localId="427" locator="163:21-163:50" strict="false" xsi:type="As">
                  <operand localId="425" locator="163:21-163:40" path="bounds" xsi:type="Property">
                     <source localId="424" locator="163:21-163:33" path="repeat" xsi:type="Property">
                        <source localId="423" locator="163:21-163:26" name="timing" xsi:type="QueryLetRef"/>
                     </source>
                  </operand>
                  <asTypeSpecifier localId="426" locator="163:45-163:50" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
               </expression>
            </let>
            <let localId="432" locator="164:7-164:58" identifier="daysSupply">
               <expression localId="431" locator="164:19-164:58" path="expectedSupplyDuration" xsi:type="Property">
                  <source localId="430" locator="164:19-164:35" path="dispenseRequest" scope="R" xsi:type="Property"/>
               </expression>
            </let>
            <let localId="436" locator="165:7-165:42" identifier="quantity">
               <expression localId="435" locator="165:17-165:42" path="quantity" xsi:type="Property">
                  <source localId="434" locator="165:17-165:33" path="dispenseRequest" scope="R" xsi:type="Property"/>
               </expression>
            </let>
            <let localId="442" locator="166:7-166:68" identifier="refills">
               <expression localId="441" locator="166:16-166:68" xsi:type="Coalesce">
                  <operand name="ToInteger" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="439" locator="166:25-166:64" path="numberOfRepeatsAllowed" xsi:type="Property">
                        <source localId="438" locator="166:25-166:41" path="dispenseRequest" scope="R" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="440" locator="166:67" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="452" locator="167:7-172:9" identifier="startDate">
               <expression localId="451" locator="168:9-172:9" xsi:type="Coalesce">
                  <operand localId="444" locator="169:11-169:31" xsi:type="Start">
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="443" locator="169:20-169:31" name="boundsPeriod" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand localId="448" locator="170:11-170:51" xsi:type="Start">
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="447" locator="170:20-170:51" path="validityPeriod" xsi:type="Property">
                           <source localId="446" locator="170:20-170:36" path="dispenseRequest" scope="R" xsi:type="Property"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="450" locator="171:11-171:22" path="authoredOn" scope="R" xsi:type="Property"/>
                  </operand>
               </expression>
            </let>
            <return localId="479" locator="173:5-181:64">
               <expression localId="478" locator="174:7-181:64" xsi:type="If">
                  <condition localId="454" locator="174:10-174:29" name="HasEnd" xsi:type="FunctionRef">
                     <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="453" locator="174:17-174:28" name="boundsPeriod" xsi:type="QueryLetRef"/>
                     </operand>
                  </condition>
                  <then localId="458" locator="175:9-175:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <low localId="455" locator="175:18-175:26" name="startDate" xsi:type="QueryLetRef"/>
                     <high localId="457" locator="175:29-175:47" xsi:type="End">
                        <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="456" locator="175:36-175:47" name="boundsPeriod" xsi:type="QueryLetRef"/>
                        </operand>
                     </high>
                  </then>
                  <else localId="477" locator="177:9-181:64" xsi:type="Query">
                     <source localId="470" locator="177:9-180:24" alias="durationInDays">
                        <expression localId="469" locator="177:9-180:9" xsi:type="Multiply">
                           <operand localId="465" locator="178:11-178:63" xsi:type="Coalesce">
                              <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand localId="459" locator="178:20-178:29" name="daysSupply" xsi:type="QueryLetRef"/>
                              </operand>
                              <operand localId="464" locator="178:32-178:62" xsi:type="Divide">
                                 <operand name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand localId="460" locator="178:32-178:39" name="quantity" xsi:type="QueryLetRef"/>
                                 </operand>
                                 <operand localId="463" locator="178:43-178:62" xsi:type="Multiply">
                                    <operand localId="461" locator="178:44-178:47" name="dose" xsi:type="QueryLetRef"/>
                                    <operand xsi:type="ToQuantity">
                                       <operand localId="462" locator="178:51-178:61" name="dosesPerDay" xsi:type="QueryLetRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                           <operand xsi:type="ToQuantity">
                              <operand localId="468" locator="179:15-179:27" xsi:type="Add">
                                 <operand localId="466" locator="179:16" valueType="t:Integer" value="1" xsi:type="Literal"/>
                                 <operand localId="467" locator="179:20-179:26" name="refills" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </expression>
                     </source>
                     <return localId="476" locator="181:11-181:64">
                        <expression localId="475" locator="181:18-181:64" lowClosed="true" highClosed="true" xsi:type="Interval">
                           <low localId="471" locator="181:27-181:35" name="startDate" xsi:type="QueryLetRef"/>
                           <high localId="474" locator="181:38-181:63" xsi:type="Add">
                              <operand localId="472" locator="181:38-181:46" name="startDate" xsi:type="QueryLetRef"/>
                              <operand localId="473" locator="181:50-181:63" name="durationInDays" xsi:type="AliasRef"/>
                           </high>
                        </expression>
                     </return>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="Request">
            <operandTypeSpecifier localId="365" locator="151:51-151:72" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="605" locator="184:1-208:4" name="DosesPerDay" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="605">
               <a:s>define function &quot;DosesPerDay&quot;(frequency Code):
	/*Calculates the cumulative dose per day for each prescription*/
	</a:s>
               <a:s r="604">
                  <a:s r="604">
                     <a:s>case
		</a:s>
                     <a:s r="488">
                        <a:s>when </a:s>
                        <a:s r="486">
                           <a:s r="483">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="485">
                              <a:s r="484">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="485">
                                 <a:s>&quot;Once daily (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="487"> then 1.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="494">
                        <a:s>when </a:s>
                        <a:s r="492">
                           <a:s r="489">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="491">
                              <a:s r="490">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="491">
                                 <a:s>&quot;Twice a day (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="493"> then 2.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="500">
                        <a:s>when </a:s>
                        <a:s r="498">
                           <a:s r="495">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="497">
                              <a:s r="496">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="497">
                                 <a:s>&quot;Three times daily (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="499"> then 3.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="506">
                        <a:s>when </a:s>
                        <a:s r="504">
                           <a:s r="501">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="503">
                              <a:s r="502">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="503">
                                 <a:s>&quot;Four times daily (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="505"> then 4.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="512">
                        <a:s>when </a:s>
                        <a:s r="510">
                           <a:s r="507">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="509">
                              <a:s r="508">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="509">
                                 <a:s>&quot;Every twenty four hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="511"> then 1.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="518">
                        <a:s>when </a:s>
                        <a:s r="516">
                           <a:s r="513">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="515">
                              <a:s r="514">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="515">
                                 <a:s>&quot;Every twelve hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="517"> then 2.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="524">
                        <a:s>when </a:s>
                        <a:s r="522">
                           <a:s r="519">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="521">
                              <a:s r="520">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="521">
                                 <a:s>&quot;Every thirty six hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="523"> then 0.67</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="530">
                        <a:s>when </a:s>
                        <a:s r="528">
                           <a:s r="525">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="527">
                              <a:s r="526">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="527">
                                 <a:s>&quot;Every eight hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="529"> then 3.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="536">
                        <a:s>when </a:s>
                        <a:s r="534">
                           <a:s r="531">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="533">
                              <a:s r="532">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="533">
                                 <a:s>&quot;Every four hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="535"> then 6.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="542">
                        <a:s>when </a:s>
                        <a:s r="540">
                           <a:s r="537">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="539">
                              <a:s r="538">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="539">
                                 <a:s>&quot;Every six hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="541"> then 4.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="548">
                        <a:s>when </a:s>
                        <a:s r="546">
                           <a:s r="543">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="545">
                              <a:s r="544">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="545">
                                 <a:s>&quot;Every seventy two hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="547"> then 0.34</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="554">
                        <a:s>when </a:s>
                        <a:s r="552">
                           <a:s r="549">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="551">
                              <a:s r="550">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="551">
                                 <a:s>&quot;Every forty eight hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="553"> then 0.5</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="560">
                        <a:s>when </a:s>
                        <a:s r="558">
                           <a:s r="555">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="557">
                              <a:s r="556">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="557">
                                 <a:s>&quot;Every eight to twelve hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="559"> then 2.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="566">
                        <a:s>when </a:s>
                        <a:s r="564">
                           <a:s r="561">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="563">
                              <a:s r="562">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="563">
                                 <a:s>&quot;Every six to eight hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="565"> then 3.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="572">
                        <a:s>when </a:s>
                        <a:s r="570">
                           <a:s r="567">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="569">
                              <a:s r="568">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="569">
                                 <a:s>&quot;Every three to four hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="571"> then 6.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="578">
                        <a:s>when </a:s>
                        <a:s r="576">
                           <a:s r="573">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="575">
                              <a:s r="574">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="575">
                                 <a:s>&quot;Every three to six hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="577"> then 4.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="584">
                        <a:s>when </a:s>
                        <a:s r="582">
                           <a:s r="579">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="581">
                              <a:s r="580">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="581">
                                 <a:s>&quot;Every two to four hours (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="583"> then 6.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="590">
                        <a:s>when </a:s>
                        <a:s r="588">
                           <a:s r="585">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="587">
                              <a:s r="586">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="587">
                                 <a:s>&quot;One to four times a day (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="589"> then 4.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="596">
                        <a:s>when </a:s>
                        <a:s r="594">
                           <a:s r="591">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="593">
                              <a:s r="592">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="593">
                                 <a:s>&quot;One to three times a day (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="595"> then 3.0</a:s>
                     </a:s>
                     <a:s>
		</a:s>
                     <a:s r="602">
                        <a:s>when </a:s>
                        <a:s r="600">
                           <a:s r="597">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="599">
                              <a:s r="598">
                                 <a:s>CustomConcepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="599">
                                 <a:s>&quot;One to two times a day (qualifier value)&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s r="601"> then 2.0</a:s>
                     </a:s>
                     <a:s r="603">
		else null 
	end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="604" locator="186:2-208:4" xsi:type="Case">
            <caseItem localId="488" locator="187:3-187:73">
               <when localId="486" locator="187:8-187:64" xsi:type="Equivalent">
                  <operand localId="483" locator="187:8-187:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="485" locator="187:20-187:64" name="Once daily (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="487" locator="187:71-187:73" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="494" locator="188:3-188:74">
               <when localId="492" locator="188:8-188:65" xsi:type="Equivalent">
                  <operand localId="489" locator="188:8-188:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="491" locator="188:20-188:65" name="Twice a day (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="493" locator="188:72-188:74" valueType="t:Decimal" value="2.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="500" locator="189:3-189:80">
               <when localId="498" locator="189:8-189:71" xsi:type="Equivalent">
                  <operand localId="495" locator="189:8-189:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="497" locator="189:20-189:71" name="Three times daily (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="499" locator="189:78-189:80" valueType="t:Decimal" value="3.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="506" locator="190:3-190:79">
               <when localId="504" locator="190:8-190:70" xsi:type="Equivalent">
                  <operand localId="501" locator="190:8-190:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="503" locator="190:20-190:70" name="Four times daily (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="505" locator="190:77-190:79" valueType="t:Decimal" value="4.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="512" locator="191:3-191:86">
               <when localId="510" locator="191:8-191:77" xsi:type="Equivalent">
                  <operand localId="507" locator="191:8-191:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="509" locator="191:20-191:77" name="Every twenty four hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="511" locator="191:84-191:86" valueType="t:Decimal" value="1.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="518" locator="192:3-192:81">
               <when localId="516" locator="192:8-192:72" xsi:type="Equivalent">
                  <operand localId="513" locator="192:8-192:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="515" locator="192:20-192:72" name="Every twelve hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="517" locator="192:79-192:81" valueType="t:Decimal" value="2.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="524" locator="193:3-193:86">
               <when localId="522" locator="193:8-193:76" xsi:type="Equivalent">
                  <operand localId="519" locator="193:8-193:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="521" locator="193:20-193:76" name="Every thirty six hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="523" locator="193:83-193:86" valueType="t:Decimal" value="0.67" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="530" locator="194:3-194:80">
               <when localId="528" locator="194:8-194:71" xsi:type="Equivalent">
                  <operand localId="525" locator="194:8-194:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="527" locator="194:20-194:71" name="Every eight hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="529" locator="194:78-194:80" valueType="t:Decimal" value="3.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="536" locator="195:3-195:79">
               <when localId="534" locator="195:8-195:70" xsi:type="Equivalent">
                  <operand localId="531" locator="195:8-195:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="533" locator="195:20-195:70" name="Every four hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="535" locator="195:77-195:79" valueType="t:Decimal" value="6.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="542" locator="196:3-196:78">
               <when localId="540" locator="196:8-196:69" xsi:type="Equivalent">
                  <operand localId="537" locator="196:8-196:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="539" locator="196:20-196:69" name="Every six hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="541" locator="196:76-196:78" valueType="t:Decimal" value="4.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="548" locator="197:3-197:87">
               <when localId="546" locator="197:8-197:77" xsi:type="Equivalent">
                  <operand localId="543" locator="197:8-197:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="545" locator="197:20-197:77" name="Every seventy two hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="547" locator="197:84-197:87" valueType="t:Decimal" value="0.34" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="554" locator="198:3-198:86">
               <when localId="552" locator="198:8-198:77" xsi:type="Equivalent">
                  <operand localId="549" locator="198:8-198:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="551" locator="198:20-198:77" name="Every forty eight hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="553" locator="198:84-198:86" valueType="t:Decimal" value="0.5" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="560" locator="199:3-199:90">
               <when localId="558" locator="199:8-199:81" xsi:type="Equivalent">
                  <operand localId="555" locator="199:8-199:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="557" locator="199:20-199:81" name="Every eight to twelve hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="559" locator="199:88-199:90" valueType="t:Decimal" value="2.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="566" locator="200:3-200:87">
               <when localId="564" locator="200:8-200:78" xsi:type="Equivalent">
                  <operand localId="561" locator="200:8-200:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="563" locator="200:20-200:78" name="Every six to eight hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="565" locator="200:85-200:87" valueType="t:Decimal" value="3.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="572" locator="201:3-201:88">
               <when localId="570" locator="201:8-201:79" xsi:type="Equivalent">
                  <operand localId="567" locator="201:8-201:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="569" locator="201:20-201:79" name="Every three to four hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="571" locator="201:86-201:88" valueType="t:Decimal" value="6.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="578" locator="202:3-202:87">
               <when localId="576" locator="202:8-202:78" xsi:type="Equivalent">
                  <operand localId="573" locator="202:8-202:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="575" locator="202:20-202:78" name="Every three to six hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="577" locator="202:85-202:87" valueType="t:Decimal" value="4.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="584" locator="203:3-203:86">
               <when localId="582" locator="203:8-203:77" xsi:type="Equivalent">
                  <operand localId="579" locator="203:8-203:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="581" locator="203:20-203:77" name="Every two to four hours (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="583" locator="203:84-203:86" valueType="t:Decimal" value="6.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="590" locator="204:3-204:86">
               <when localId="588" locator="204:8-204:77" xsi:type="Equivalent">
                  <operand localId="585" locator="204:8-204:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="587" locator="204:20-204:77" name="One to four times a day (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="589" locator="204:84-204:86" valueType="t:Decimal" value="4.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="596" locator="205:3-205:87">
               <when localId="594" locator="205:8-205:78" xsi:type="Equivalent">
                  <operand localId="591" locator="205:8-205:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="593" locator="205:20-205:78" name="One to three times a day (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="595" locator="205:85-205:87" valueType="t:Decimal" value="3.0" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="602" locator="206:3-206:85">
               <when localId="600" locator="206:8-206:76" xsi:type="Equivalent">
                  <operand localId="597" locator="206:8-206:16" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="599" locator="206:20-206:76" name="One to two times a day (qualifier value)" libraryName="CustomConcepts" xsi:type="CodeRef"/>
               </when>
               <then localId="601" locator="206:83-206:85" valueType="t:Decimal" value="2.0" xsi:type="Literal"/>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="603" locator="207:8-207:11" xsi:type="Null"/>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="482" locator="184:41-184:44" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="619" locator="229:3-232:60" name="STI_testing" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="619">
               <a:s>//define function &quot;GetMedicationDailyDose&quot;(dosage Quantity, dosesPerDay Decimal):
  //dosage * Quantity { value: dosesPerDay, unit: '/d' }












  
  


//need to define
  define STI_testing:
    </a:s>
               <a:s r="618">
                  <a:s>
                     <a:s r="607">
                        <a:s r="606">
                           <a:s r="606">
                              <a:s>[Procedure]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> P</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="617">
                     <a:s>where </a:s>
                     <a:s r="617">
                        <a:s r="611">
                           <a:s r="609">
                              <a:s r="608">
                                 <a:s>P</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="609">
                                 <a:s>status</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="610">
                              <a:s>'completed'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  and </a:s>
                        <a:s r="616">
                           <a:s r="613">
                              <a:s r="612">
                                 <a:s>P</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="613">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="615">
                              <a:s r="614">
                                 <a:s>Concepts</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="615">
                                 <a:s>&quot;STI testing and treatment services&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="618" locator="230:5-232:60" xsi:type="Query">
            <source localId="607" locator="230:5-230:17" alias="P">
               <expression localId="606" locator="230:5-230:15" dataType="fhir:Procedure" templateId="http://hl7.org/fhir/StructureDefinition/Procedure" xsi:type="Retrieve"/>
            </source>
            <where localId="617" locator="231:3-232:60" xsi:type="And">
               <operand localId="611" locator="231:9-231:30" xsi:type="Equal">
                  <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="609" locator="231:9-231:16" path="status" scope="P" xsi:type="Property"/>
                  </operand>
                  <operand localId="610" locator="231:20-231:30" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
               <operand localId="616" locator="232:7-232:60" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="613" locator="232:7-232:12" path="code" scope="P" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand localId="615" locator="232:16-232:60" name="STI testing and treatment services" libraryName="Concepts" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="660" locator="238:1-248:5" name="ExtractMedicationCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="660">
               <a:s>/**
 * @description Takes a choice between a Medication and a CodeableConcept and returns just the code of the medication
 */
define function ExtractMedicationCode(choice Choice&lt;FHIR.CodeableConcept, FHIR.Reference>):
  </a:s>
               <a:s r="659">
                  <a:s r="659">
                     <a:s>case
	  </a:s>
                     <a:s r="629">
                        <a:s>when </a:s>
                        <a:s r="625">
                           <a:s r="623">
                              <a:s>choice</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="624">
                              <a:s>FHIR.CodeableConcept</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
    	</a:s>
                        <a:s r="628">
                           <a:s r="626">
                              <a:s>choice</a:s>
                           </a:s>
                           <a:s> as </a:s>
                           <a:s r="627">
                              <a:s>FHIR.CodeableConcept</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="650">
                        <a:s>when </a:s>
                        <a:s r="632">
                           <a:s r="630">
                              <a:s>choice</a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="631">
                              <a:s>FHIR.Reference</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="649">
                           <a:s>First(</a:s>
                           <a:s r="648">
                              <a:s>
                                 <a:s r="634">
                                    <a:s r="633">
                                       <a:s r="633">
                                          <a:s>[Medication]</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> M</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> 
        </a:s>
                              <a:s r="642">
                                 <a:s>where </a:s>
                                 <a:s r="642">
                                    <a:s r="636">
                                       <a:s r="635">
                                          <a:s>M</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="636">
                                          <a:s>id</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> = </a:s>
                                    <a:s r="641">
                                       <a:s>Last(</a:s>
                                       <a:s r="640">
                                          <a:s>Split(</a:s>
                                          <a:s r="638">
                                             <a:s r="637">
                                                <a:s>choice</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="638">
                                                <a:s>reference</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="639">
                                             <a:s>'/'</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="647">
                                 <a:s>return </a:s>
                                 <a:s r="646">
                                    <a:s r="644">
                                       <a:s r="643">
                                          <a:s>M</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="644">
                                          <a:s>code</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> as </a:s>
                                    <a:s r="645">
                                       <a:s>FHIR.CodeableConcept</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else
      </a:s>
                     <a:s r="658">
                        <a:s>Message(</a:s>
                        <a:s r="653">
                           <a:s r="651">null as </a:s>
                           <a:s r="652">
                              <a:s>FHIR.CodeableConcept</a:s>
                           </a:s>
                        </a:s>
                        <a:s r="654">, true, </a:s>
                        <a:s r="655">
                           <a:s>'1'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="656">
                           <a:s>'Error'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="657">
                           <a:s>'Cannot compute a medication code'</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s> // TODO: I'm sure that this is supported somehow?
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="659" locator="239:3-248:5" xsi:type="Case">
            <caseItem localId="629" locator="240:4-241:35">
               <when localId="625" locator="240:9-240:38" xsi:type="Is">
                  <operand localId="623" locator="240:9-240:14" name="choice" xsi:type="OperandRef"/>
                  <isTypeSpecifier localId="624" locator="240:19-240:38" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="628" locator="241:6-241:35" strict="false" xsi:type="As">
                  <operand localId="626" locator="241:6-241:11" name="choice" xsi:type="OperandRef"/>
                  <asTypeSpecifier localId="627" locator="241:16-241:35" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               </then>
            </caseItem>
            <caseItem localId="650" locator="242:5-245:46">
               <when localId="632" locator="242:10-242:33" xsi:type="Is">
                  <operand localId="630" locator="242:10-242:15" name="choice" xsi:type="OperandRef"/>
                  <isTypeSpecifier localId="631" locator="242:20-242:33" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="649" locator="243:7-245:46" xsi:type="First">
                  <source localId="648" locator="243:13-245:45" xsi:type="Query">
                     <source localId="634" locator="243:13-243:26" alias="M">
                        <expression localId="633" locator="243:13-243:24" dataType="fhir:Medication" templateId="http://hl7.org/fhir/StructureDefinition/Medication" xsi:type="Retrieve"/>
                     </source>
                     <where localId="642" locator="244:9-244:55" xsi:type="Equal">
                        <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="636" locator="244:15-244:18" path="id" scope="M" xsi:type="Property"/>
                        </operand>
                        <operand localId="641" locator="244:22-244:55" xsi:type="Last">
                           <source localId="640" locator="244:27-244:54" xsi:type="Split">
                              <stringToSplit name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand localId="638" locator="244:33-244:48" path="reference" xsi:type="Property">
                                    <source localId="637" locator="244:33-244:38" name="choice" xsi:type="OperandRef"/>
                                 </operand>
                              </stringToSplit>
                              <separator localId="639" locator="244:51-244:53" valueType="t:String" value="/" xsi:type="Literal"/>
                           </source>
                        </operand>
                     </where>
                     <return localId="647" locator="245:9-245:45">
                        <expression localId="646" locator="245:16-245:45" strict="false" xsi:type="As">
                           <operand localId="644" locator="245:16-245:21" path="code" scope="M" xsi:type="Property"/>
                           <asTypeSpecifier localId="645" locator="245:26-245:45" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                        </expression>
                     </return>
                  </source>
               </then>
            </caseItem>
            <else localId="658" locator="247:7-247:99" xsi:type="Message">
               <source localId="653" locator="247:15-247:42" strict="false" xsi:type="As">
                  <operand localId="651" locator="247:15-247:18" xsi:type="Null"/>
                  <asTypeSpecifier localId="652" locator="247:23-247:42" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               </source>
               <condition localId="654" locator="247:45-247:48" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               <code localId="655" locator="247:51-247:53" valueType="t:String" value="1" xsi:type="Literal"/>
               <severity localId="656" locator="247:56-247:62" valueType="t:String" value="Error" xsi:type="Literal"/>
               <message localId="657" locator="247:65-247:98" valueType="t:String" value="Cannot compute a medication code" xsi:type="Literal"/>
            </else>
         </expression>
         <operand name="choice">
            <operandTypeSpecifier localId="622" locator="238:46-238:89" xsi:type="ChoiceTypeSpecifier">
               <choice localId="620" locator="238:53-238:72" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               <choice localId="621" locator="238:75-238:88" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="675" locator="253:1-257:5" name="getObservationCode" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="675">
               <a:s>/**
 * @description Returns the code of an Observation CodeableConcept
 */
define fluent function getObservationCode(observation FHIR.Observation):
  </a:s>
               <a:s r="674">
                  <a:s r="674">
                     <a:s>case 
    </a:s>
                     <a:s r="672">
                        <a:s>when </a:s>
                        <a:s r="665">
                           <a:s r="663">
                              <a:s r="662">
                                 <a:s>observation</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="663">
                                 <a:s>code</a:s>
                              </a:s>
                           </a:s>
                           <a:s> is </a:s>
                           <a:s r="664">
                              <a:s>FHIR.CodeableConcept</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="671">
                           <a:s r="670">
                              <a:s r="669">
                                 <a:s>(</a:s>
                                 <a:s r="669">
                                    <a:s r="667">
                                       <a:s r="666">
                                          <a:s>observation</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="667">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> as </a:s>
                                    <a:s r="668">
                                       <a:s>CodeableConcept</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="670">
                                 <a:s>coding</a:s>
                              </a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="671">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s r="673">
    else null
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="674" locator="254:3-257:5" xsi:type="Case">
            <caseItem localId="672" locator="255:5-255:105">
               <when localId="665" locator="255:10-255:49" xsi:type="Is">
                  <operand localId="663" locator="255:10-255:25" path="code" xsi:type="Property">
                     <source localId="662" locator="255:10-255:20" name="observation" xsi:type="OperandRef"/>
                  </operand>
                  <isTypeSpecifier localId="664" locator="255:30-255:49" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
               </when>
               <then localId="671" locator="255:56-255:105" xsi:type="Query">
                  <source alias="$this">
                     <expression localId="670" locator="255:56-255:100" path="coding" xsi:type="Property">
                        <source localId="669" locator="255:56-255:93" strict="false" xsi:type="As">
                           <operand localId="667" locator="255:57-255:73" path="value" xsi:type="Property">
                              <source localId="666" locator="255:57-255:67" name="observation" xsi:type="OperandRef"/>
                           </operand>
                           <asTypeSpecifier localId="668" locator="255:78-255:92" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </expression>
                  </source>
                  <where xsi:type="Not">
                     <operand xsi:type="IsNull">
                        <operand path="code" xsi:type="Property">
                           <source name="$this" xsi:type="AliasRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return distinct="false">
                     <expression path="code" xsi:type="Property">
                        <source name="$this" xsi:type="AliasRef"/>
                     </expression>
                  </return>
               </then>
            </caseItem>
            <else xsi:type="As">
               <operand localId="673" locator="256:10-256:13" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:code" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </else>
         </expression>
         <operand name="observation">
            <operandTypeSpecifier localId="661" locator="253:55-253:70" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="684" locator="262:1-263:45" name="getObservationCodes" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="684">
               <a:s>/**
 * @description Returns a list of codes of an a list of Observations
 */
define fluent function getObservationCodes(obslist List&lt;FHIR.Observation>):
  </a:s>
               <a:s r="683">
                  <a:s r="683">
                     <a:s>
                        <a:s r="679">
                           <a:s r="678">
                              <a:s>
                                 <a:s>obslist</a:s>
                              </a:s>
                           </a:s>
                           <a:s> obs</a:s>
                        </a:s>
                     </a:s>
                     <a:s> </a:s>
                     <a:s r="682">
                        <a:s>return </a:s>
                        <a:s r="681">
                           <a:s r="680">
                              <a:s>obs</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="681">
                              <a:s>getObservationCode()</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="683" locator="263:3-263:45" xsi:type="Query">
            <source localId="679" locator="263:3-263:13" alias="obs">
               <expression localId="678" locator="263:3-263:9" name="obslist" xsi:type="OperandRef"/>
            </source>
            <return localId="682" locator="263:15-263:45">
               <expression localId="681" locator="263:22-263:45" name="getObservationCode" xsi:type="FunctionRef">
                  <operand localId="680" locator="263:22-263:24" name="obs" xsi:type="AliasRef"/>
               </expression>
            </return>
         </expression>
         <operand name="obslist">
            <operandTypeSpecifier localId="677" locator="262:52-262:73" xsi:type="ListTypeSpecifier">
               <elementType localId="676" locator="262:57-262:72" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>
