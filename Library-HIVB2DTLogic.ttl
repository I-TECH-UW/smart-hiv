@prefix fhir: <http://hl7.org/fhir/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# - resource -------------------------------------------------------------------

<http://smart.who.int/hiv/Library/HIVB2DTLogic> a fhir:Library ;
  fhir:nodeRole fhir:treeRoot ;
  fhir:id [ fhir:v "HIVB2DTLogic"] ; # 
  fhir:meta [
     fhir:profile ( [
       fhir:v "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-shareablelibrary"^^xsd:anyURI ;
       fhir:link <http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-shareablelibrary>
     ] [
       fhir:v "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-publishablelibrary"^^xsd:anyURI ;
       fhir:link <http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-publishablelibrary>
     ] [
       fhir:v "http://hl7.org/fhir/uv/cql/StructureDefinition/cql-library"^^xsd:anyURI ;
       fhir:link <http://hl7.org/fhir/uv/cql/StructureDefinition/cql-library>
     ] [
       fhir:v "http://hl7.org/fhir/uv/cql/StructureDefinition/cql-module"^^xsd:anyURI ;
       fhir:link <http://hl7.org/fhir/uv/cql/StructureDefinition/cql-module>
     ] )
  ] ; # 
  fhir:text [
     fhir:status [ fhir:v "generated" ] ;
     fhir:div "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p class=\"res-header-id\"><b>Generated Narrative: Library HIVB2DTLogic</b></p><a name=\"HIVB2DTLogic\"> </a><a name=\"hcHIVB2DTLogic\"> </a><a name=\"HIVB2DTLogic-en-US\"> </a><h2>Contents</h2><p><code>text/cql</code></p><pre><code class=\"language-sql\">/**\nLibrary: HIV.B2.DT Logic\n\n@DecisionID: HIV.B2.DT\n@BusinessRule: Check for signs of serious illness\n@Trigger: HIV.B2 Check for signs of serious illness\n@Trigger: HIV.D3 Check for signs of serious illness\n@HitPolicy: Rule Order\n@Description: Check for serious illness\n\nData Concepts:\n * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth\n * HIV.D.DE17: Signs of serious illness | Signs that may indicate the client has a serious illness and needs triage or an emergency referral\n * HIV.D.DE9: Body temperature | Temperature of the client in Celsius\n\nConsolidated guidelines on HIV prevention, testing, treatment, service delivery and monitoring: recommendations for a public health approach (2021) Chapter 5: Advanced HIV Disease. Figure 5.1: Algorithm for providing a package of care for people with advanced HIV disease.\n*/\n\nlibrary HIVB2DTLogic\n\nusing FHIR version '4.0.1'\n\ninclude HIVCommon version '0.0.1' called HIC\ninclude HIVConcepts called HCx\ninclude HIVEncounterElements called Elements\ninclude FHIRHelpers version '4.0.1'\n\ninclude WHOCommon called WCom\n\ncontext Patient\n\n /*\n  @input: &quot;Age 10 or older&quot;\n  @pseudocode: 'Age' &gt;= 10 years\n  */\ndefine &quot;Age 10 or older&quot;:\n  AgeInYearsAt(Today()) &gt;= 10\n\n /*\n  @input: &quot;Age under 10&quot;\n  @pseudocode: 'Age' &lt; 10 years\n  */\ndefine &quot;Age under 10&quot;:\n  AgeInYearsAt(Today()) &lt; 10\n\n/*\n @output: &quot;Immediately take action or refer for care if a client is having this issue&quot;\n */\ndefine &quot;Immediately take action or refer for care if a client is having this issue&quot;:\n  exists(Elements.&quot;Signs of serious illness&quot; O\n    where &quot;Age 10 or older&quot; \n      and O.value ~ HCx.&quot;Tachycardia&quot;)\n\n/*\n @output &quot;Immediately take action or refer for care if client is showing this sign of a serious illness.&quot;\n */\ndefine &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot;:\n  &quot;Signs of serious illness age 10 or older&quot; or &quot;Signs of serious illness age under 10&quot;\n\n/*\n @output &quot;Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill&quot;\n */\ndefine &quot;Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill&quot;:\n  &quot;Signs of serious illness requiring clinical judgement age 10 or older&quot; or &quot;Signs of serious illness requiring clinical judgement age under 10&quot;\n\n/*\n @dynamicValue: Guidance\n */\ndefine &quot;Guidance&quot;:\n  case \n  when &quot;Immediately take action or refer for care if a client is having this issue&quot; \n    then &quot;Immediately take action or refer for care if a client is having this issue.&quot;\n  when &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot; and &quot;Age 10 or older&quot;\n    then &quot;Immediately take action or refer for care if client is showing this sign of a serious illness.&quot;\n  when &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot; and &quot;Age under 10&quot;\n    then &quot;&quot;&quot;This is a sign and/or symptom of a serious health condition.\n  \nImmediately take action or refer for care if client is showing this sign of a serious illness.&quot;&quot;&quot;\n  else null\n  end\n\n/*\n Supporting Logic\n*/\ndefine &quot;Signs of serious illness age 10 or older&quot;:\n  &quot;Age 10 or older&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where\n      O.value ~ HCx.&quot;Tachypnea&quot; or\n      O.value ~ HCx.&quot;Unable to walk unaided&quot;\n\ndefine &quot;Signs of serious illness age under 10&quot;:\n  &quot;Age under 10&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where \n      O.value in {\n        HCx.&quot;Lethargy - HIV.D.DE22&quot;,\n        HCx.&quot;Unconsciousness&quot;,\n        HCx.&quot;Convulsions&quot;,\n        HCx.&quot;Unable to breastfeed&quot;,\n        HCx.&quot;Unable to drink&quot;,\n        HCx.&quot;Repeated vomiting&quot;\n      } \n  \ndefine &quot;Signs of serious illness requiring clinical judgement age 10 or older&quot;:\n  &quot;Age 10 or older&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where\n      O.value ~ HCx.&quot;Fever of 39 C or greater&quot; or\n      O.value ~ HCx.&quot;Other sign of serious illness&quot;\n  \ndefine &quot;Signs of serious illness requiring clinical judgement age under 10&quot;:\n  &quot;Age under 10&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where \n      O.value ~ HCx.&quot;Fever of 39 C or greater&quot; or\n      O.value ~ HCx.&quot;Other sign of serious illness&quot;\n</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>"
  ] ; # 
  fhir:extension ( [
     fhir:url [ fhir:v "http://hl7.org/fhir/StructureDefinition/cqf-knowledgeCapability"^^xsd:anyURI ] ;
     fhir:value [ fhir:v "computable" ]
  ] ) ; # 
  fhir:url [ fhir:v "http://smart.who.int/hiv/Library/HIVB2DTLogic"^^xsd:anyURI] ; # 
  fhir:version [ fhir:v "0.2.0"] ; # 
  fhir:name [ fhir:v "HIVB2DTLogic"] ; # 
  fhir:title [ fhir:v "HIV.B2.DT Logic"] ; # 
  fhir:status [ fhir:v "draft"] ; # 
  fhir:experimental [ fhir:v "true"^^xsd:boolean] ; # 
  fhir:type [
     fhir:coding ( [
       fhir:system [ fhir:v "http://terminology.hl7.org/CodeSystem/library-type"^^xsd:anyURI ] ;
       fhir:code [ fhir:v "logic-library" ]
     ] )
  ] ; # 
  fhir:date [ fhir:v "2024-08-12T23:19:51+00:00"^^xsd:dateTime] ; # 
  fhir:publisher [ fhir:v "WHO"] ; # 
  fhir:contact ( [
     fhir:name [ fhir:v "WHO" ] ;
     fhir:telecom ( [
       fhir:system [ fhir:v "url" ] ;
       fhir:value [ fhir:v "http://who.int" ]
     ] )
  ] ) ; # 
  fhir:description [ fhir:v "Description not yet available for HIV.B2.DT Logic."] ; # 
  fhir:content ( [
     fhir:contentType [ fhir:v "text/cql" ] ;
     fhir:data [ fhir:v "LyoqCkxpYnJhcnk6IEhJVi5CMi5EVCBMb2dpYwoKQERlY2lzaW9uSUQ6IEhJVi5CMi5EVApAQnVzaW5lc3NSdWxlOiBDaGVjayBmb3Igc2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzCkBUcmlnZ2VyOiBISVYuQjIgQ2hlY2sgZm9yIHNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcwpAVHJpZ2dlcjogSElWLkQzIENoZWNrIGZvciBzaWducyBvZiBzZXJpb3VzIGlsbG5lc3MKQEhpdFBvbGljeTogUnVsZSBPcmRlcgpARGVzY3JpcHRpb246IENoZWNrIGZvciBzZXJpb3VzIGlsbG5lc3MKCkRhdGEgQ29uY2VwdHM6CiAqIEhJVi5BLkRFMTc6IEFnZSB8IENhbGN1bGF0ZWQgYWdlIChudW1iZXIgb2YgeWVhcnMpIG9mIHRoZSBjbGllbnQgYmFzZWQgb24gZGF0ZSBvZiBiaXJ0aAogKiBISVYuRC5ERTE3OiBTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgfCBTaWducyB0aGF0IG1heSBpbmRpY2F0ZSB0aGUgY2xpZW50IGhhcyBhIHNlcmlvdXMgaWxsbmVzcyBhbmQgbmVlZHMgdHJpYWdlIG9yIGFuIGVtZXJnZW5jeSByZWZlcnJhbAogKiBISVYuRC5ERTk6IEJvZHkgdGVtcGVyYXR1cmUgfCBUZW1wZXJhdHVyZSBvZiB0aGUgY2xpZW50IGluIENlbHNpdXMKCkNvbnNvbGlkYXRlZCBndWlkZWxpbmVzIG9uIEhJViBwcmV2ZW50aW9uLCB0ZXN0aW5nLCB0cmVhdG1lbnQsIHNlcnZpY2UgZGVsaXZlcnkgYW5kIG1vbml0b3Jpbmc6IHJlY29tbWVuZGF0aW9ucyBmb3IgYSBwdWJsaWMgaGVhbHRoIGFwcHJvYWNoICgyMDIxKSBDaGFwdGVyIDU6IEFkdmFuY2VkIEhJViBEaXNlYXNlLiBGaWd1cmUgNS4xOiBBbGdvcml0aG0gZm9yIHByb3ZpZGluZyBhIHBhY2thZ2Ugb2YgY2FyZSBmb3IgcGVvcGxlIHdpdGggYWR2YW5jZWQgSElWIGRpc2Vhc2UuCiovCgpsaWJyYXJ5IEhJVkIyRFRMb2dpYwoKdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScKCmluY2x1ZGUgSElWQ29tbW9uIHZlcnNpb24gJzAuMC4xJyBjYWxsZWQgSElDCmluY2x1ZGUgSElWQ29uY2VwdHMgY2FsbGVkIEhDeAppbmNsdWRlIEhJVkVuY291bnRlckVsZW1lbnRzIGNhbGxlZCBFbGVtZW50cwppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJwoKaW5jbHVkZSBXSE9Db21tb24gY2FsbGVkIFdDb20KCmNvbnRleHQgUGF0aWVudAoKIC8qCiAgQGlucHV0OiAiQWdlIDEwIG9yIG9sZGVyIgogIEBwc2V1ZG9jb2RlOiAnQWdlJyA+PSAxMCB5ZWFycwogICovCmRlZmluZSAiQWdlIDEwIG9yIG9sZGVyIjoKICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPj0gMTAKCiAvKgogIEBpbnB1dDogIkFnZSB1bmRlciAxMCIKICBAcHNldWRvY29kZTogJ0FnZScgPCAxMCB5ZWFycwogICovCmRlZmluZSAiQWdlIHVuZGVyIDEwIjoKICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPCAxMAoKLyoKIEBvdXRwdXQ6ICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBhIGNsaWVudCBpcyBoYXZpbmcgdGhpcyBpc3N1ZSIKICovCmRlZmluZSAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgYSBjbGllbnQgaXMgaGF2aW5nIHRoaXMgaXNzdWUiOgogIGV4aXN0cyhFbGVtZW50cy4iU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIiBPCiAgICB3aGVyZSAiQWdlIDEwIG9yIG9sZGVyIiAKICAgICAgYW5kIE8udmFsdWUgfiBIQ3guIlRhY2h5Y2FyZGlhIikKCi8qCiBAb3V0cHV0ICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBjbGllbnQgaXMgc2hvd2luZyB0aGlzIHNpZ24gb2YgYSBzZXJpb3VzIGlsbG5lc3MuIgogKi8KZGVmaW5lICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBjbGllbnQgaXMgc2hvd2luZyB0aGlzIHNpZ24gb2YgYSBzZXJpb3VzIGlsbG5lc3MiOgogICJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgYWdlIDEwIG9yIG9sZGVyIiBvciAiU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIGFnZSB1bmRlciAxMCIKCi8qCiBAb3V0cHV0ICJVc2UgY2xpbmljYWwganVkZ2VtZW50IGFuZCBjb25zaWRlciBsb2NhbCBlcGlkZW1pb2xvZ3kgdG8gZGV0ZXJtaW5lIGlmIHN5bXB0b21zIHN1Z2dlc3QgY2xpZW50IGlzIHNlcmlvdXNseSBpbGwiCiAqLwpkZWZpbmUgIlVzZSBjbGluaWNhbCBqdWRnZW1lbnQgYW5kIGNvbnNpZGVyIGxvY2FsIGVwaWRlbWlvbG9neSB0byBkZXRlcm1pbmUgaWYgc3ltcHRvbXMgc3VnZ2VzdCBjbGllbnQgaXMgc2VyaW91c2x5IGlsbCI6CiAgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyByZXF1aXJpbmcgY2xpbmljYWwganVkZ2VtZW50IGFnZSAxMCBvciBvbGRlciIgb3IgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyByZXF1aXJpbmcgY2xpbmljYWwganVkZ2VtZW50IGFnZSB1bmRlciAxMCIKCi8qCiBAZHluYW1pY1ZhbHVlOiBHdWlkYW5jZQogKi8KZGVmaW5lICJHdWlkYW5jZSI6CiAgY2FzZSAKICB3aGVuICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBhIGNsaWVudCBpcyBoYXZpbmcgdGhpcyBpc3N1ZSIgCiAgICB0aGVuICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBhIGNsaWVudCBpcyBoYXZpbmcgdGhpcyBpc3N1ZS4iCiAgd2hlbiAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgY2xpZW50IGlzIHNob3dpbmcgdGhpcyBzaWduIG9mIGEgc2VyaW91cyBpbGxuZXNzIiBhbmQgIkFnZSAxMCBvciBvbGRlciIKICAgIHRoZW4gIkltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGNsaWVudCBpcyBzaG93aW5nIHRoaXMgc2lnbiBvZiBhIHNlcmlvdXMgaWxsbmVzcy4iCiAgd2hlbiAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgY2xpZW50IGlzIHNob3dpbmcgdGhpcyBzaWduIG9mIGEgc2VyaW91cyBpbGxuZXNzIiBhbmQgIkFnZSB1bmRlciAxMCIKICAgIHRoZW4gIiIiVGhpcyBpcyBhIHNpZ24gYW5kL29yIHN5bXB0b20gb2YgYSBzZXJpb3VzIGhlYWx0aCBjb25kaXRpb24uCiAgCkltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGNsaWVudCBpcyBzaG93aW5nIHRoaXMgc2lnbiBvZiBhIHNlcmlvdXMgaWxsbmVzcy4iIiIKICBlbHNlIG51bGwKICBlbmQKCi8qCiBTdXBwb3J0aW5nIExvZ2ljCiovCmRlZmluZSAiU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIGFnZSAxMCBvciBvbGRlciI6CiAgIkFnZSAxMCBvciBvbGRlciIgYW5kIEVsZW1lbnRzLiJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MiIE8KICAgIHdoZXJlCiAgICAgIE8udmFsdWUgfiBIQ3guIlRhY2h5cG5lYSIgb3IKICAgICAgTy52YWx1ZSB+IEhDeC4iVW5hYmxlIHRvIHdhbGsgdW5haWRlZCIKCmRlZmluZSAiU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIGFnZSB1bmRlciAxMCI6CiAgIkFnZSB1bmRlciAxMCIgYW5kIEVsZW1lbnRzLiJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MiIE8KICAgIHdoZXJlIAogICAgICBPLnZhbHVlIGluIHsKICAgICAgICBIQ3guIkxldGhhcmd5IC0gSElWLkQuREUyMiIsCiAgICAgICAgSEN4LiJVbmNvbnNjaW91c25lc3MiLAogICAgICAgIEhDeC4iQ29udnVsc2lvbnMiLAogICAgICAgIEhDeC4iVW5hYmxlIHRvIGJyZWFzdGZlZWQiLAogICAgICAgIEhDeC4iVW5hYmxlIHRvIGRyaW5rIiwKICAgICAgICBIQ3guIlJlcGVhdGVkIHZvbWl0aW5nIgogICAgICB9IAogIApkZWZpbmUgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyByZXF1aXJpbmcgY2xpbmljYWwganVkZ2VtZW50IGFnZSAxMCBvciBvbGRlciI6CiAgIkFnZSAxMCBvciBvbGRlciIgYW5kIEVsZW1lbnRzLiJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MiIE8KICAgIHdoZXJlCiAgICAgIE8udmFsdWUgfiBIQ3guIkZldmVyIG9mIDM5IEMgb3IgZ3JlYXRlciIgb3IKICAgICAgTy52YWx1ZSB+IEhDeC4iT3RoZXIgc2lnbiBvZiBzZXJpb3VzIGlsbG5lc3MiCiAgCmRlZmluZSAiU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIHJlcXVpcmluZyBjbGluaWNhbCBqdWRnZW1lbnQgYWdlIHVuZGVyIDEwIjoKICAiQWdlIHVuZGVyIDEwIiBhbmQgRWxlbWVudHMuIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyIgTwogICAgd2hlcmUgCiAgICAgIE8udmFsdWUgfiBIQ3guIkZldmVyIG9mIDM5IEMgb3IgZ3JlYXRlciIgb3IKICAgICAgTy52YWx1ZSB+IEhDeC4iT3RoZXIgc2lnbiBvZiBzZXJpb3VzIGlsbG5lc3MiCg=="^^xsd:base64Binary ]
  ] [
     fhir:contentType [ fhir:v "application/elm+xml" ]
  ] ) . # 

# -------------------------------------------------------------------------------------

