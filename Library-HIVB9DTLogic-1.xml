<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:t name="DecisionID" value="HIV.B9.DT.HIV Re-testing Recommendations"/>
      <a:t name="BusinessRule" value="HIV restesting recommendations"/>
      <a:t name="Trigger" value="HIV.B9 Determine recommended services"/>
      <a:t name="HitPolicy" value="Rule order"/>
      <a:t name="Description" value="Determine retest recommendation&#xa;&#xa;Data Concepts:&#xa;HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.&#xa;HIV.B.DE33: Partner HIV status (reported) | The HIV status of the client's partner.&#xa;HIV.C.DE55: Sex partner's HIV treatment status | Treatment adherence of client's sex partner for partners that are HIV-positive&#xa;HIV.Config.DE12: HIV burden of the setting | HIV burden of the setting (high or low) based on the national HIV prevalence or where the HIV prevalence and/or incidence in a geographical setting is higher than national prevalence and, therefore, needs priority in the HIV response&#xa;HIV.B.DE49: Key population member | Client is a member of a key population that has an increased risk of HIV&#xa;HIV.B.DE29: Currently pregnant | Client is currently pregnant&#xa;HIV.D.DE939: TB diagnosis result | Final result of the TB investigation (bacteriological and/or clinical)&#xa;HIV.D.DE282: Presumptive TB | Client's comorbidities or coinfections or symptoms of these include presumptive TB&#xa;HIV.C.DE10: Currently on PrEP | The client is currently taking PrEP. Oral pre-exposure prophylaxis (PrEP) of HIV is the use of ARV drugs by people who are not infected with HIV to block the acquisition of HIV.&#xa;HIV.B.DE225: At elevated risk for HIV acquisition | Client is at elevated risk for HIV acquisition"/>
      <a:s r="106">
         <a:s>/*
Library: HIV.B9.DT Logic

@DecisionID: HIV.B9.DT.HIV Re-testing Recommendations
@BusinessRule: HIV restesting recommendations
@Trigger: HIV.B9 Determine recommended services
@HitPolicy: Rule order
@Description: Determine retest recommendation

Data Concepts:
 * HIV.B.DE115: HIV status | HIV status reported after applying the national HIV testing algorithm. No single HIV test can provide an HIV-positive diagnosis.
 * HIV.B.DE33: Partner HIV status (reported) | The HIV status of the client's partner.
 * HIV.C.DE55: Sex partner's HIV treatment status | Treatment adherence of client's sex partner for partners that are HIV-positive
 * HIV.Config.DE12: HIV burden of the setting | HIV burden of the setting (high or low) based on the national HIV prevalence or where the HIV prevalence and/or incidence in a geographical setting is higher than national prevalence and, therefore, needs priority in the HIV response
 * HIV.B.DE49: Key population member | Client is a member of a key population that has an increased risk of HIV
 * HIV.B.DE29: Currently pregnant | Client is currently pregnant
 * HIV.D.DE939: TB diagnosis result | Final result of the TB investigation (bacteriological and/or clinical)
 * HIV.D.DE282: Presumptive TB | Client's comorbidities or coinfections or symptoms of these include presumptive TB
 * HIV.C.DE10: Currently on PrEP | The client is currently taking PrEP. Oral pre-exposure prophylaxis (PrEP) of HIV is the use of ARV drugs by people who are not infected with HIV to block the acquisition of HIV.
 * HIV.B.DE225: At elevated risk for HIV acquisition | Client is at elevated risk for HIV acquisition
*/
library HIVB9DTLogic</a:s>
      </a:s>
   </annotation>
   <identifier id="HIVB9DTLogic" system="http://smart.who.int/hiv"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="25:1-25:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>// Included Libraries
using </a:s>
               <a:s>
                  <a:s>FHIR</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="27:1-27:47" localIdentifier="Common" path="http://smart.who.int/hiv/HIVCommon" version="0.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVCommon</a:s>
               </a:s>
               <a:s> version '0.0.1' called Common</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="28:1-28:35" localIdentifier="Concepts" path="http://smart.who.int/hiv/HIVConcepts">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVConcepts</a:s>
               </a:s>
               <a:s> called Concepts</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="4" locator="29:1-29:31" localIdentifier="Config" path="http://smart.who.int/hiv/HIVConfig">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVConfig</a:s>
               </a:s>
               <a:s> called Config</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="30:1-30:44" localIdentifier="Elements" path="http://smart.who.int/hiv/HIVEncounterElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>include </a:s>
               <a:s>
                  <a:s>HIVEncounterElements</a:s>
               </a:s>
               <a:s> called Elements</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="6" locator="31:1-31:35" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.1'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="7" locator="33:1-33:29" localIdentifier="WCom" path="http://smart.who.int/hiv/WHOCommon">
         <annotation xsi:type="a:Annotation">
            <a:s r="7">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOCommon</a:s>
               </a:s>
               <a:s> called WCom</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="8" locator="35:1-35:30" localIdentifier="WCx" path="http://smart.who.int/hiv/WHOConcepts">
         <annotation xsi:type="a:Annotation">
            <a:s r="8">
               <a:s>// Included for PlanDefinition
include </a:s>
               <a:s>
                  <a:s>WHOConcepts</a:s>
               </a:s>
               <a:s> called WCx</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="9" locator="36:1-36:40" localIdentifier="WElm" path="http://smart.who.int/hiv/WHOEncounterElements">
         <annotation xsi:type="a:Annotation">
            <a:s r="9">
               <a:s>include </a:s>
               <a:s>
                  <a:s>WHOEncounterElements</a:s>
               </a:s>
               <a:s> called WElm</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="12" locator="38:1-38:36" name="Today" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="12">
               <a:s>parameter Today </a:s>
               <a:s r="11">
                  <a:s>Date</a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="10">
                  <a:s>Today()</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="10" locator="38:30-38:36" xsi:type="Today"/>
         <parameterTypeSpecifier localId="11" locator="38:17-38:20" name="t:Date" xsi:type="NamedTypeSpecifier"/>
      </def>
   </parameters>
   <contexts>
      <def locator="40:1-40:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="40:1-40:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="40:1-40:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/StructureDefinition/Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="28" locator="46:1-49:39" name="HIV status negative or unknown" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;HIV status negative or unknown&quot;"/>
            <a:t name="pseudocode" value="&quot;HIV status&quot; IN 'HIV-negative', 'Unknown'"/>
            <a:s r="28">
               <a:s>/*
  @input: &quot;HIV status negative or unknown&quot;
  @pseudocode: &quot;HIV status&quot; IN 'HIV-negative', 'Unknown'
  */
define &quot;HIV status negative or unknown&quot;:
  </a:s>
               <a:s r="27">
                  <a:s>exists</a:s>
                  <a:s r="26">
                     <a:s>(</a:s>
                     <a:s r="26">
                        <a:s>
                           <a:s r="14">
                              <a:s r="13">
                                 <a:s>
                                    <a:s>Elements.&quot;HIV Status Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> S</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="25">
                           <a:s>where </a:s>
                           <a:s r="25">
                              <a:s r="19">
                                 <a:s r="16">
                                    <a:s r="15">
                                       <a:s>S</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="16">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> ~ </a:s>
                                 <a:s r="18">
                                    <a:s r="17">
                                       <a:s>Concepts</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="18">
                                       <a:s>&quot;HIV-negative&quot;</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
       or </a:s>
                              <a:s r="24">
                                 <a:s r="21">
                                    <a:s r="20">
                                       <a:s>S</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="21">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> ~ </a:s>
                                 <a:s r="23">
                                    <a:s r="22">
                                       <a:s>Concepts</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="23">
                                       <a:s>&quot;Unknown&quot;</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="27" locator="47:3-49:39" xsi:type="Exists">
            <operand localId="26" locator="47:9-49:39" xsi:type="Query">
               <source localId="14" locator="47:10-47:44" alias="S">
                  <expression localId="13" locator="47:10-47:42" name="HIV Status Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="25" locator="48:5-49:38" xsi:type="Or">
                  <operand localId="19" locator="48:11-48:43" xsi:type="Equivalent">
                     <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand asType="fhir:CodeableConcept" xsi:type="As">
                           <operand localId="16" locator="48:11-48:17" path="value" scope="S" xsi:type="Property"/>
                        </operand>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="18" locator="48:21-48:43" name="HIV-negative" libraryName="Concepts" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
                  <operand localId="24" locator="49:11-49:38" xsi:type="Equivalent">
                     <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand asType="fhir:CodeableConcept" xsi:type="As">
                           <operand localId="21" locator="49:11-49:17" path="value" scope="S" xsi:type="Property"/>
                        </operand>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="23" locator="49:21-49:38" name="Unknown" libraryName="Concepts" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="38" locator="55:1-57:44" name="Partner HIV positive" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Partner HIV reported positive&quot;"/>
            <a:t name="pseudocode" value="&quot;Partner HIV status (reported)&quot;='HIV-positive'"/>
            <a:s r="38">
               <a:s>/*
  @input: &quot;Partner HIV reported positive&quot;
  @pseudocode: &quot;Partner HIV status (reported)&quot;='HIV-positive'
  */
define &quot;Partner HIV positive&quot;:
  </a:s>
               <a:s r="37">
                  <a:s>exists</a:s>
                  <a:s r="36">
                     <a:s>(</a:s>
                     <a:s r="36">
                        <a:s>
                           <a:s r="30">
                              <a:s r="29">
                                 <a:s>
                                    <a:s>Elements.&quot;Partner HIV status reported Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="35">
                           <a:s>where </a:s>
                           <a:s r="35">
                              <a:s r="32">
                                 <a:s r="31">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="32">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> ~ </a:s>
                              <a:s r="34">
                                 <a:s r="33">
                                    <a:s>Concepts</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="34">
                                    <a:s>&quot;HIV-positive&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="37" locator="56:3-57:44" xsi:type="Exists">
            <operand localId="36" locator="56:9-57:44" xsi:type="Query">
               <source localId="30" locator="56:10-56:61" alias="O">
                  <expression localId="29" locator="56:10-56:59" name="Partner HIV status reported Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="35" locator="57:5-57:43" xsi:type="Equivalent">
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:CodeableConcept" xsi:type="As">
                        <operand localId="32" locator="57:11-57:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="34" locator="57:21-57:43" name="HIV-positive" libraryName="Concepts" xsi:type="CodeRef"/>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="48" locator="63:1-65:65" name="Sex partner's HIV treatment status is partner not virally suppressed" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Sex partner's HIV treatment status is partner not virally suppressed&quot;"/>
            <a:t name="pseudocode" value="&quot;Sex partner's HIV treatment status&quot;='Partner is not virally suppressed'"/>
            <a:s r="48">
               <a:s>/*
  @input: &quot;Sex partner's HIV treatment status is partner not virally suppressed&quot;
  @pseudocode: &quot;Sex partner's HIV treatment status&quot;='Partner is not virally suppressed'
  */
define &quot;Sex partner's HIV treatment status is partner not virally suppressed&quot;:
  </a:s>
               <a:s r="47">
                  <a:s>exists</a:s>
                  <a:s r="46">
                     <a:s>(</a:s>
                     <a:s r="46">
                        <a:s>
                           <a:s r="40">
                              <a:s r="39">
                                 <a:s>
                                    <a:s>Elements.&quot;Sex partners HIV treatment status&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="45">
                           <a:s>where </a:s>
                           <a:s r="45">
                              <a:s r="42">
                                 <a:s r="41">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="42">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> ~ </a:s>
                              <a:s r="44">
                                 <a:s r="43">
                                    <a:s>Concepts</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="44">
                                    <a:s>&quot;Partner is not virally suppressed&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="47" locator="64:3-65:65" xsi:type="Exists">
            <operand localId="46" locator="64:9-65:65" xsi:type="Query">
               <source localId="40" locator="64:10-64:55" alias="O">
                  <expression localId="39" locator="64:10-64:53" name="Sex partners HIV treatment status" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="45" locator="65:5-65:64" xsi:type="Equivalent">
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:CodeableConcept" xsi:type="As">
                        <operand localId="42" locator="65:11-65:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="44" locator="65:21-65:64" name="Partner is not virally suppressed" libraryName="Concepts" xsi:type="CodeRef"/>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="54" locator="71:1-72:69" name="HIV burden of setting is high HIV burden setting" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;HIV burden of setting is high HIV burden setting&quot;"/>
            <a:t name="pseudocode" value="&quot;HIV burden of the setting&quot;='High HIV burden setting'"/>
            <a:s r="54">
               <a:s>/*
  @input: &quot;HIV burden of setting is high HIV burden setting&quot;
  @pseudocode: &quot;HIV burden of the setting&quot;='High HIV burden setting'
  */
define &quot;HIV burden of setting is high HIV burden setting&quot;:
  </a:s>
               <a:s r="53">
                  <a:s r="50">
                     <a:s r="49">
                        <a:s>Config</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="50">
                        <a:s>&quot;HIV burden of setting&quot;</a:s>
                     </a:s>
                  </a:s>
                  <a:s> ~ </a:s>
                  <a:s r="52">
                     <a:s r="51">
                        <a:s>Concepts</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="52">
                        <a:s>&quot;High HIV burden setting&quot;</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="53" locator="72:3-72:69" xsi:type="Equivalent">
            <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
            <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
            <operand localId="50" locator="72:3-72:32" name="HIV burden of setting" libraryName="Config" xsi:type="ExpressionRef"/>
            <operand localId="52" locator="72:36-72:69" name="High HIV burden setting" libraryName="Concepts" xsi:type="CodeRef"/>
         </expression>
      </def>
      <def localId="60" locator="78:1-79:68" name="HIV burden of setting is low HIV burden setting" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;HIV burden of setting is low HIV burden setting&quot;"/>
            <a:t name="pseudocode" value="&quot;HIV burden of the setting&quot;='Low HIV burden setting'"/>
            <a:s r="60">
               <a:s>/*
  @input: &quot;HIV burden of setting is low HIV burden setting&quot;
  @pseudocode: &quot;HIV burden of the setting&quot;='Low HIV burden setting'
  */
define &quot;HIV burden of setting is low HIV burden setting&quot;:
  </a:s>
               <a:s r="59">
                  <a:s r="56">
                     <a:s r="55">
                        <a:s>Config</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="56">
                        <a:s>&quot;HIV burden of setting&quot;</a:s>
                     </a:s>
                  </a:s>
                  <a:s> ~ </a:s>
                  <a:s r="58">
                     <a:s r="57">
                        <a:s>Concepts</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="58">
                        <a:s>&quot;Low HIV burden setting&quot;</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="59" locator="79:3-79:68" xsi:type="Equivalent">
            <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
            <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
            <operand localId="56" locator="79:3-79:32" name="HIV burden of setting" libraryName="Config" xsi:type="ExpressionRef"/>
            <operand localId="58" locator="79:36-79:68" name="Low HIV burden setting" libraryName="Concepts" xsi:type="CodeRef"/>
         </expression>
      </def>
      <def localId="63" locator="85:1-86:44" name="Key population member" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Key population member&quot;"/>
            <a:t name="pseudocode" value="&quot;Key population member&quot; = TRUE"/>
            <a:s r="63">
               <a:s>/*
  @input: &quot;Key population member&quot;
  @pseudocode: &quot;Key population member&quot; = TRUE
  */
define &quot;Key population member&quot;:
  </a:s>
               <a:s r="62">
                  <a:s r="61">
                     <a:s>Elements</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="62">
                     <a:s>&quot;Is Key population member B.DE49&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="62" locator="86:3-86:44" name="Is Key population member B.DE49" libraryName="Elements" xsi:type="ExpressionRef"/>
      </def>
      <def localId="67" locator="92:1-93:37" name="Currently pregnant" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Currently pregnant&quot;"/>
            <a:t name="pseudocode" value="&quot;Currently pregnant&quot;=True"/>
            <a:s r="67">
               <a:s>/*
  @input: &quot;Currently pregnant&quot;
  @pseudocode: &quot;Currently pregnant&quot;=True
  */
define &quot;Currently pregnant&quot;:
  </a:s>
               <a:s r="66">
                  <a:s>exists</a:s>
                  <a:s r="65">
                     <a:s>(</a:s>
                     <a:s r="65">
                        <a:s r="64">
                           <a:s>WElm</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="65">
                           <a:s>&quot;Pregnant Observation&quot;</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="66" locator="93:3-93:37" xsi:type="Exists">
            <operand localId="65" locator="93:9-93:37" name="Pregnant Observation" libraryName="WElm" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="77" locator="99:1-101:44" name="TB diagnosis result is diagnosed TB" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;TB diagnosis result is diagnosed TB&quot;"/>
            <a:t name="pseudocode" value="&quot;Currently pregnant&quot;=True"/>
            <a:s r="77">
               <a:s>/*
  @input: &quot;TB diagnosis result is diagnosed TB&quot;
  @pseudocode: &quot;Currently pregnant&quot;=True
  */
define &quot;TB diagnosis result is diagnosed TB&quot;:
  </a:s>
               <a:s r="76">
                  <a:s>exists</a:s>
                  <a:s r="75">
                     <a:s>(</a:s>
                     <a:s r="75">
                        <a:s>
                           <a:s r="69">
                              <a:s r="68">
                                 <a:s>
                                    <a:s>Elements.&quot;TB diagnosis result Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="74">
                           <a:s>where </a:s>
                           <a:s r="74">
                              <a:s r="71">
                                 <a:s r="70">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="71">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> ~ </a:s>
                              <a:s r="73">
                                 <a:s r="72">
                                    <a:s>Concepts</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="73">
                                    <a:s>&quot;Diagnosed TB&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="76" locator="100:3-101:44" xsi:type="Exists">
            <operand localId="75" locator="100:9-101:44" xsi:type="Query">
               <source localId="69" locator="100:10-100:53" alias="O">
                  <expression localId="68" locator="100:10-100:51" name="TB diagnosis result Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="74" locator="101:5-101:43" xsi:type="Equivalent">
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:CodeableConcept" xsi:type="As">
                        <operand localId="71" locator="101:11-101:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <signature name="t:Code" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="73" locator="101:21-101:43" name="Diagnosed TB" libraryName="Concepts" xsi:type="CodeRef"/>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="85" locator="107:1-109:26" name="Presumptive TB" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Presumptive TB&quot;"/>
            <a:t name="pseudocode" value="&quot;Presumptive TB&quot;=True"/>
            <a:s r="85">
               <a:s>/*
  @input: &quot;Presumptive TB&quot;
  @pseudocode: &quot;Presumptive TB&quot;=True
  */
define &quot;Presumptive TB&quot;:
  </a:s>
               <a:s r="84">
                  <a:s>exists</a:s>
                  <a:s r="83">
                     <a:s>(</a:s>
                     <a:s r="83">
                        <a:s>
                           <a:s r="79">
                              <a:s r="78">
                                 <a:s>
                                    <a:s>Elements.&quot;Presumptive TB D.DE282 Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="82">
                           <a:s>where </a:s>
                           <a:s r="82">
                              <a:s r="81">
                                 <a:s r="80">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="81">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is true</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="84" locator="108:3-109:26" xsi:type="Exists">
            <operand localId="83" locator="108:9-109:26" xsi:type="Query">
               <source localId="79" locator="108:10-108:56" alias="O">
                  <expression localId="78" locator="108:10-108:54" name="Presumptive TB D.DE282 Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="82" locator="109:5-109:25" xsi:type="IsTrue">
                  <operand name="ToBoolean" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:boolean" xsi:type="As">
                        <operand localId="81" locator="109:11-109:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="93" locator="115:1-117:26" name="Currently on PrEP" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;Currently on PrEP&quot;"/>
            <a:t name="pseudocode" value="&quot;Currently on PrEP&quot;=True"/>
            <a:s r="93">
               <a:s>/*
  @input: &quot;Currently on PrEP&quot;
  @pseudocode: &quot;Currently on PrEP&quot;=True
  */
define &quot;Currently on PrEP&quot;:
  </a:s>
               <a:s r="92">
                  <a:s>exists</a:s>
                  <a:s r="91">
                     <a:s>(</a:s>
                     <a:s r="91">
                        <a:s>
                           <a:s r="87">
                              <a:s r="86">
                                 <a:s>
                                    <a:s>Elements.&quot;Currently on PrEP Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="90">
                           <a:s>where </a:s>
                           <a:s r="90">
                              <a:s r="89">
                                 <a:s r="88">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="89">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is true</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="92" locator="116:3-117:26" xsi:type="Exists">
            <operand localId="91" locator="116:9-117:26" xsi:type="Query">
               <source localId="87" locator="116:10-116:51" alias="O">
                  <expression localId="86" locator="116:10-116:49" name="Currently on PrEP Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="90" locator="117:5-117:25" xsi:type="IsTrue">
                  <operand name="ToBoolean" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:boolean" xsi:type="As">
                        <operand localId="89" locator="117:11-117:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="101" locator="123:1-125:26" name="At elevated risk for HIV acquisition" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="input" value="&quot;At elevated risk for HIV acquisition&quot;"/>
            <a:t name="pseudocode" value="&quot;At elevated risk for HIV acquisition&quot;=True"/>
            <a:s r="101">
               <a:s>/*
  @input: &quot;At elevated risk for HIV acquisition&quot;
  @pseudocode: &quot;At elevated risk for HIV acquisition&quot;=True
  */
define &quot;At elevated risk for HIV acquisition&quot;:
  </a:s>
               <a:s r="100">
                  <a:s>exists</a:s>
                  <a:s r="99">
                     <a:s>(</a:s>
                     <a:s r="99">
                        <a:s>
                           <a:s r="95">
                              <a:s r="94">
                                 <a:s>
                                    <a:s>Elements.&quot;At elevated risk for HIV acquisition PRV.DE1 Observation&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> O</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    </a:s>
                        <a:s r="98">
                           <a:s>where </a:s>
                           <a:s r="98">
                              <a:s r="97">
                                 <a:s r="96">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="97">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is true</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="100" locator="124:3-125:26" xsi:type="Exists">
            <operand localId="99" locator="124:9-125:26" xsi:type="Query">
               <source localId="95" locator="124:10-124:78" alias="O">
                  <expression localId="94" locator="124:10-124:76" name="At elevated risk for HIV acquisition PRV.DE1 Observation" libraryName="Elements" xsi:type="ExpressionRef"/>
               </source>
               <where localId="98" locator="125:5-125:25" xsi:type="IsTrue">
                  <operand name="ToBoolean" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:boolean" xsi:type="As">
                        <operand localId="97" locator="125:11-125:17" path="value" scope="O" xsi:type="Property"/>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
      </def>
      <def localId="106" locator="250:1-251:99" name="Partner has HIV and is not virally suppressed" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="106">
               <a:s>define &quot;Partner has HIV and is not virally suppressed&quot;:
  </a:s>
               <a:s r="105">
                  <a:s r="103">
                     <a:s>&quot;Partner HIV positive&quot;</a:s>
                  </a:s>
                  <a:s> and </a:s>
                  <a:s r="104">
                     <a:s>&quot;Sex partner's HIV treatment status is partner not virally suppressed&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="105" locator="251:3-251:99" xsi:type="And">
            <operand localId="103" locator="251:3-251:24" name="Partner HIV positive" xsi:type="ExpressionRef"/>
            <operand localId="104" locator="251:30-251:99" name="Sex partner's HIV treatment status is partner not virally suppressed" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="122" locator="131:1-143:7" name="Schedule an annual follow-up test" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Schedule an annual follow-up test&quot;"/>
            <a:t name="pseudocode" value="&quot;Follow-up test recommended date&quot; = &quot;Visit date&quot; + 1 year"/>
            <a:s r="122">
               <a:s>/*
  @output: &quot;Schedule an annual follow-up test&quot;
  @pseudocode: &quot;Follow-up test recommended date&quot; = &quot;Visit date&quot; + 1 year
  */
define &quot;Schedule an annual follow-up test&quot;:
  </a:s>
               <a:s r="121">
                  <a:s r="102">
                     <a:s>&quot;HIV status negative or unknown&quot;</a:s>
                  </a:s>
                  <a:s> and
    </a:s>
                  <a:s r="120">
                     <a:s>case
    </a:s>
                     <a:s r="109">
                        <a:s>when </a:s>
                        <a:s r="107">
                           <a:s>&quot;Partner has HIV and is not virally suppressed&quot;</a:s>
                        </a:s>
                        <a:s r="108">
      then true</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="112">
                        <a:s>when </a:s>
                        <a:s r="110">
                           <a:s>&quot;HIV burden of setting is high HIV burden setting&quot;</a:s>
                        </a:s>
                        <a:s r="111">
      then true</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="115">
                        <a:s>when </a:s>
                        <a:s r="113">
                           <a:s>&quot;Key population member&quot;</a:s>
                        </a:s>
                        <a:s r="114">
      then true</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="118">
                        <a:s>when </a:s>
                        <a:s r="116">
                           <a:s>&quot;At elevated risk for HIV acquisition&quot;</a:s>
                        </a:s>
                        <a:s r="117">
      then true</a:s>
                     </a:s>
                     <a:s r="119">
    else false
    end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="121" locator="132:3-143:7" xsi:type="And">
            <operand localId="102" locator="132:3-132:34" name="HIV status negative or unknown" xsi:type="ExpressionRef"/>
            <operand localId="120" locator="133:5-143:7" xsi:type="Case">
               <caseItem localId="109" locator="134:5-135:15">
                  <when localId="107" locator="134:10-134:56" name="Partner has HIV and is not virally suppressed" xsi:type="ExpressionRef"/>
                  <then localId="108" locator="135:12-135:15" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="112" locator="136:5-137:15">
                  <when localId="110" locator="136:10-136:59" name="HIV burden of setting is high HIV burden setting" xsi:type="ExpressionRef"/>
                  <then localId="111" locator="137:12-137:15" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="115" locator="138:5-139:15">
                  <when localId="113" locator="138:10-138:32" name="Key population member" xsi:type="ExpressionRef"/>
                  <then localId="114" locator="139:12-139:15" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="118" locator="140:5-141:15">
                  <when localId="116" locator="140:10-140:47" name="At elevated risk for HIV acquisition" xsi:type="ExpressionRef"/>
                  <then localId="117" locator="141:12-141:15" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <else localId="119" locator="142:10-142:14" valueType="t:Boolean" value="false" xsi:type="Literal"/>
            </operand>
         </expression>
      </def>
      <def localId="133" locator="149:1-157:5" name="Follow-up test recommended" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Follow-up test recommended&quot;"/>
            <a:t name="pseudocode" value="N/A"/>
            <a:s r="133">
               <a:s>/*
 @output: &quot;Follow-up test recommended&quot;
 @pseudocode: N/A
 */
define &quot;Follow-up test recommended&quot;:
  </a:s>
               <a:s r="132">
                  <a:s r="123">
                     <a:s>&quot;HIV status negative or unknown&quot;</a:s>
                  </a:s>
                  <a:s> and
  </a:s>
                  <a:s r="131">
                     <a:s>case
  </a:s>
                     <a:s r="126">
                        <a:s>when </a:s>
                        <a:s r="124">
                           <a:s>&quot;TB diagnosis result is diagnosed TB&quot;</a:s>
                        </a:s>
                        <a:s r="125">
    then true</a:s>
                     </a:s>
                     <a:s>
  </a:s>
                     <a:s r="129">
                        <a:s>when </a:s>
                        <a:s r="127">
                           <a:s>&quot;Presumptive TB&quot;</a:s>
                        </a:s>
                        <a:s r="128">
    then true</a:s>
                     </a:s>
                     <a:s r="130">
  else false
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="132" locator="150:3-157:5" xsi:type="And">
            <operand localId="123" locator="150:3-150:34" name="HIV status negative or unknown" xsi:type="ExpressionRef"/>
            <operand localId="131" locator="151:3-157:5" xsi:type="Case">
               <caseItem localId="126" locator="152:3-153:13">
                  <when localId="124" locator="152:8-152:44" name="TB diagnosis result is diagnosed TB" xsi:type="ExpressionRef"/>
                  <then localId="125" locator="153:10-153:13" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="129" locator="154:3-155:13">
                  <when localId="127" locator="154:8-154:23" name="Presumptive TB" xsi:type="ExpressionRef"/>
                  <then localId="128" locator="155:10-155:13" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <else localId="130" locator="156:8-156:12" valueType="t:Boolean" value="false" xsi:type="Literal"/>
            </operand>
         </expression>
      </def>
      <def localId="137" locator="163:1-164:58" name="Schedule quarterly retesting for PrEP users" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Schedule quarterly retesting for PrEP users&quot;"/>
            <a:t name="pseudocode" value="N/A"/>
            <a:s r="137">
               <a:s>/*
 @output: &quot;Schedule quarterly retesting for PrEP users&quot;
 @pseudocode: N/A
 */
define &quot;Schedule quarterly retesting for PrEP users&quot;:
  </a:s>
               <a:s r="136">
                  <a:s r="134">
                     <a:s>&quot;HIV status negative or unknown&quot;</a:s>
                  </a:s>
                  <a:s> and </a:s>
                  <a:s r="135">
                     <a:s>&quot;Currently on PrEP&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="136" locator="164:3-164:58" xsi:type="And">
            <operand localId="134" locator="164:3-164:34" name="HIV status negative or unknown" xsi:type="ExpressionRef"/>
            <operand localId="135" locator="164:40-164:58" name="Currently on PrEP" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="143" locator="240:1-243:22" name="Pregnant in high HIV burden setting" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="143">
               <a:s>// Helper Logic
define &quot;Pregnant in high HIV burden setting&quot;:
  </a:s>
               <a:s r="142">
                  <a:s r="140">
                     <a:s r="138">
                        <a:s>&quot;HIV status negative or unknown&quot;</a:s>
                     </a:s>
                     <a:s> and
  </a:s>
                     <a:s r="139">
                        <a:s>&quot;HIV burden of setting is high HIV burden setting&quot;</a:s>
                     </a:s>
                  </a:s>
                  <a:s> and
  </a:s>
                  <a:s r="141">
                     <a:s>&quot;Currently pregnant&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="142" locator="241:3-243:22" xsi:type="And">
            <operand localId="140" locator="241:3-242:52" xsi:type="And">
               <operand localId="138" locator="241:3-241:34" name="HIV status negative or unknown" xsi:type="ExpressionRef"/>
               <operand localId="139" locator="242:3-242:52" name="HIV burden of setting is high HIV burden setting" xsi:type="ExpressionRef"/>
            </operand>
            <operand localId="141" locator="243:3-243:22" name="Currently pregnant" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="145" locator="170:1-171:39" name="Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy&quot;"/>
            <a:t name="pseudocode" value="N/A"/>
            <a:s r="145">
               <a:s>/*
 @output: &quot;Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy&quot;
 @pseudocode: N/A
 */
define &quot;Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy&quot;:
  </a:s>
               <a:s r="144">
                  <a:s>&quot;Pregnant in high HIV burden setting&quot;</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="144" locator="171:3-171:39" name="Pregnant in high HIV burden setting" xsi:type="ExpressionRef"/>
      </def>
      <def localId="147" locator="177:1-178:39" name="Schedule a 'Follow-up test recommended date' during a third trimester visit" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Schedule a 'Follow-up test recommended date during a third trimester visit&quot;"/>
            <a:t name="pseudocode" value="N/A"/>
            <a:s r="147">
               <a:s>/*
 @output: &quot;Schedule a 'Follow-up test recommended date during a third trimester visit&quot;
 @pseudocode: N/A
 */
define &quot;Schedule a 'Follow-up test recommended date' during a third trimester visit&quot;:
  </a:s>
               <a:s r="146">
                  <a:s>&quot;Pregnant in high HIV burden setting&quot;</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="146" locator="178:3-178:39" name="Pregnant in high HIV burden setting" xsi:type="ExpressionRef"/>
      </def>
      <def localId="153" locator="245:1-248:22" name="Pregnant in low HIV burden setting" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="153">
               <a:s>define &quot;Pregnant in low HIV burden setting&quot;:
  </a:s>
               <a:s r="152">
                  <a:s r="150">
                     <a:s r="148">
                        <a:s>&quot;HIV status negative or unknown&quot;</a:s>
                     </a:s>
                     <a:s> and
  </a:s>
                     <a:s r="149">
                        <a:s>&quot;HIV burden of setting is low HIV burden setting&quot;</a:s>
                     </a:s>
                  </a:s>
                  <a:s> and
  </a:s>
                  <a:s r="151">
                     <a:s>&quot;Currently pregnant&quot;</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="152" locator="246:3-248:22" xsi:type="And">
            <operand localId="150" locator="246:3-247:51" xsi:type="And">
               <operand localId="148" locator="246:3-246:34" name="HIV status negative or unknown" xsi:type="ExpressionRef"/>
               <operand localId="149" locator="247:3-247:51" name="HIV burden of setting is low HIV burden setting" xsi:type="ExpressionRef"/>
            </operand>
            <operand localId="151" locator="248:3-248:22" name="Currently pregnant" xsi:type="ExpressionRef"/>
         </expression>
      </def>
      <def localId="167" locator="184:1-194:5" name="Schedule a 'Follow-up test recommended date' at first ANC contact date" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="output" value="&quot;Schedule a 'Follow-up test recommended date during a third trimester visit&quot;"/>
            <a:t name="pseudocode" value="N/A"/>
            <a:s r="167">
               <a:s>/*
 @output: &quot;Schedule a 'Follow-up test recommended date during a third trimester visit&quot;
 @pseudocode: N/A
 */
define &quot;Schedule a 'Follow-up test recommended date' at first ANC contact date&quot;:
  </a:s>
               <a:s r="166">
                  <a:s r="154">
                     <a:s>&quot;Pregnant in low HIV burden setting&quot;</a:s>
                  </a:s>
                  <a:s> and 
  </a:s>
                  <a:s r="165">
                     <a:s>case
  </a:s>
                     <a:s r="157">
                        <a:s>when </a:s>
                        <a:s r="155">
                           <a:s>&quot;Key population member&quot;</a:s>
                        </a:s>
                        <a:s r="156">
    then true</a:s>
                     </a:s>
                     <a:s>
  </a:s>
                     <a:s r="160">
                        <a:s>when </a:s>
                        <a:s r="158">
                           <a:s>&quot;Partner has HIV and is not virally suppressed&quot;</a:s>
                        </a:s>
                        <a:s r="159">
    then true</a:s>
                     </a:s>
                     <a:s>
  </a:s>
                     <a:s r="163">
                        <a:s>when </a:s>
                        <a:s r="161">
                           <a:s>&quot;At elevated risk for HIV acquisition&quot;</a:s>
                        </a:s>
                        <a:s r="162">
    then true</a:s>
                     </a:s>
                     <a:s r="164">
  else false
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="166" locator="185:3-194:5" xsi:type="And">
            <operand localId="154" locator="185:3-185:38" name="Pregnant in low HIV burden setting" xsi:type="ExpressionRef"/>
            <operand localId="165" locator="186:3-194:5" xsi:type="Case">
               <caseItem localId="157" locator="187:3-188:13">
                  <when localId="155" locator="187:8-187:30" name="Key population member" xsi:type="ExpressionRef"/>
                  <then localId="156" locator="188:10-188:13" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="160" locator="189:3-190:13">
                  <when localId="158" locator="189:8-189:54" name="Partner has HIV and is not virally suppressed" xsi:type="ExpressionRef"/>
                  <then localId="159" locator="190:10-190:13" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <caseItem localId="163" locator="191:3-192:13">
                  <when localId="161" locator="191:8-191:45" name="At elevated risk for HIV acquisition" xsi:type="ExpressionRef"/>
                  <then localId="162" locator="192:10-192:13" valueType="t:Boolean" value="true" xsi:type="Literal"/>
               </caseItem>
               <else localId="164" locator="193:8-193:12" valueType="t:Boolean" value="false" xsi:type="Literal"/>
            </operand>
         </expression>
      </def>
      <def localId="190" locator="199:1-225:4" name="Guidance" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="dynamicValue" value="Guidance"/>
            <a:s r="190">
               <a:s>/*
 @dynamicValue: Guidance
 */
define &quot;Guidance&quot;:
  </a:s>
               <a:s r="189">
                  <a:s>Combine(</a:s>
                  <a:s r="188">
                     <a:s>{
    </a:s>
                     <a:s r="171">
                        <a:s>if </a:s>
                        <a:s r="168">
                           <a:s>&quot;Schedule an annual follow-up test&quot;</a:s>
                        </a:s>
                        <a:s>
      then </a:s>
                        <a:s r="169">
                           <a:s>'Schedule an annual follow-up test.  

  WHO guidance recommends annual retesting for people who have ongoing HIV-related risks in all settings. These include people with a known HIV-positive partner who is not virally suppressed on ART.'</a:s>
                        </a:s>
                        <a:s>
      else </a:s>
                        <a:s r="170">
                           <a:s>''</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="175">
                        <a:s>if </a:s>
                        <a:s r="172">
                           <a:s>&quot;Follow-up test recommended&quot;</a:s>
                        </a:s>
                        <a:s>
      then </a:s>
                        <a:s r="173">
                           <a:s>'Recommend a follow-up test.  

  In certain conditions and situations, individuals who have been tested for HIV in the past can be advised to retest. These include: 
  * Individuals presenting with a diagnosis or receiving treatment for STIs or viral hepatitis, 
  * Individuals with a confirmed or presumptive TB diagnosis, 
  * Outpatients presenting with clinical conditions or symptoms indicative of HIV, individuals with recent HIV risk exposure.'</a:s>
                        </a:s>
                        <a:s>
      else </a:s>
                        <a:s r="174">
                           <a:s>''</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="179">
                        <a:s>if </a:s>
                        <a:s r="176">
                           <a:s>&quot;Schedule quarterly retesting for PrEP users&quot;</a:s>
                        </a:s>
                        <a:s>
      then </a:s>
                        <a:s r="177">
                           <a:s>'Schedule quarterly retesting for PrEP users.'</a:s>
                        </a:s>
                        <a:s>
      else </a:s>
                        <a:s r="178">
                           <a:s>''</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="183">
                        <a:s>if </a:s>
                        <a:s r="180">
                           <a:s>&quot;Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy&quot;</a:s>
                        </a:s>
                        <a:s>
      then </a:s>
                        <a:s r="181">
                           <a:s>'Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy

  All pregnant women should be tested for HIV as well as syphilis and hepatitis B virus at least once and as early as possible during pregnancy.'</a:s>
                        </a:s>
                        <a:s>
      else </a:s>
                        <a:s r="182">
                           <a:s>''</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s r="187">
                        <a:s>if </a:s>
                        <a:s r="184">
                           <a:s>&quot;Schedule a 'Follow-up test recommended date' at first ANC contact date&quot;</a:s>
                        </a:s>
                        <a:s>
      then </a:s>
                        <a:s r="185">
                           <a:s>'In low HIV burden settings, retesting all pregnant women is not warranted unless focused among women from key populations or at high ongoing risk, such as those from key populations or with partners with HIV who are not virally suppressed. Countries could consider one additional retest in the post-partum period, such as at 14 weeks, six months or nine months for women in high HIV burden or incidence districts or provinces, key populations or women with partners with HIV who are not virally suppressed.'</a:s>
                        </a:s>
                        <a:s>
      else </a:s>
                        <a:s r="186">
                           <a:s>''</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  }</a:s>
                  </a:s>
                  <a:s>)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="189" locator="200:3-225:4" xsi:type="Combine">
            <source localId="188" locator="200:11-225:3" xsi:type="List">
               <element localId="171" locator="201:5-205:13" xsi:type="If">
                  <condition localId="168" locator="201:8-201:42" name="Schedule an annual follow-up test" xsi:type="ExpressionRef"/>
                  <then localId="169" locator="202:12-202:249" valueType="t:String" value="Schedule an annual follow-up test.  &#xa;&#xa;  WHO guidance recommends annual retesting for people who have ongoing HIV-related risks in all settings. These include people with a known HIV-positive partner who is not virally suppressed on ART." xsi:type="Literal"/>
                  <else localId="170" locator="205:12-205:13" valueType="t:String" value="" xsi:type="Literal"/>
               </element>
               <element localId="175" locator="206:5-213:13" xsi:type="If">
                  <condition localId="172" locator="206:8-206:35" name="Follow-up test recommended" xsi:type="ExpressionRef"/>
                  <then localId="173" locator="207:12-207:464" valueType="t:String" value="Recommend a follow-up test.  &#xa;&#xa;  In certain conditions and situations, individuals who have been tested for HIV in the past can be advised to retest. These include: &#xa;  * Individuals presenting with a diagnosis or receiving treatment for STIs or viral hepatitis, &#xa;  * Individuals with a confirmed or presumptive TB diagnosis, &#xa;  * Outpatients presenting with clinical conditions or symptoms indicative of HIV, individuals with recent HIV risk exposure." xsi:type="Literal"/>
                  <else localId="174" locator="213:12-213:13" valueType="t:String" value="" xsi:type="Literal"/>
               </element>
               <element localId="179" locator="214:5-216:13" xsi:type="If">
                  <condition localId="176" locator="214:8-214:52" name="Schedule quarterly retesting for PrEP users" xsi:type="ExpressionRef"/>
                  <then localId="177" locator="215:12-215:57" valueType="t:String" value="Schedule quarterly retesting for PrEP users." xsi:type="Literal"/>
                  <else localId="178" locator="216:12-216:13" valueType="t:String" value="" xsi:type="Literal"/>
               </element>
               <element localId="183" locator="217:5-221:13" xsi:type="If">
                  <condition localId="180" locator="217:8-217:105" name="Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy" xsi:type="ExpressionRef"/>
                  <then localId="181" locator="218:12-218:255" valueType="t:String" value="Schedule an HIV test, syphilis test, hepatitis B test as early as possible during this pregnancy&#xa;&#xa;  All pregnant women should be tested for HIV as well as syphilis and hepatitis B virus at least once and as early as possible during pregnancy." xsi:type="Literal"/>
                  <else localId="182" locator="221:12-221:13" valueType="t:String" value="" xsi:type="Literal"/>
               </element>
               <element localId="187" locator="222:5-224:13" xsi:type="If">
                  <condition localId="184" locator="222:8-222:79" name="Schedule a 'Follow-up test recommended date' at first ANC contact date" xsi:type="ExpressionRef"/>
                  <then localId="185" locator="223:12-223:519" valueType="t:String" value="In low HIV burden settings, retesting all pregnant women is not warranted unless focused among women from key populations or at high ongoing risk, such as those from key populations or with partners with HIV who are not virally suppressed. Countries could consider one additional retest in the post-partum period, such as at 14 weeks, six months or nine months for women in high HIV burden or incidence districts or provinces, key populations or women with partners with HIV who are not virally suppressed." xsi:type="Literal"/>
                  <else localId="186" locator="224:12-224:13" valueType="t:String" value="" xsi:type="Literal"/>
               </element>
            </source>
         </expression>
      </def>
      <def localId="203" locator="230:1-237:5" name="Schedule Follow-up Date" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:t name="dynamicValue" value="&quot;Date to schedule&quot;"/>
            <a:s r="203">
               <a:s>/*
 @dynamicValue: &quot;Date to schedule&quot;
 */
define &quot;Schedule Follow-up Date&quot;:
  </a:s>
               <a:s r="202">
                  <a:s>case
  </a:s>
                  <a:s r="195">
                     <a:s>when </a:s>
                     <a:s r="191">
                        <a:s>&quot;Schedule an annual follow-up test&quot;</a:s>
                     </a:s>
                     <a:s>
    then </a:s>
                     <a:s r="194">
                        <a:s r="192">
                           <a:s>Today</a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="193">
                           <a:s>1 years</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>
  </a:s>
                  <a:s r="200">
                     <a:s>when </a:s>
                     <a:s r="196">
                        <a:s>&quot;Schedule quarterly retesting for PrEP users&quot;</a:s>
                     </a:s>
                     <a:s>
    then </a:s>
                     <a:s r="199">
                        <a:s r="197">
                           <a:s>Today</a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="198">
                           <a:s>3 months</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s r="201">
  else null
  end</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="202" locator="231:3-237:5" xsi:type="Case">
            <caseItem localId="195" locator="232:3-233:24">
               <when localId="191" locator="232:8-232:42" name="Schedule an annual follow-up test" xsi:type="ExpressionRef"/>
               <then localId="194" locator="233:10-233:24" xsi:type="Add">
                  <signature name="t:Date" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="192" locator="233:10-233:14" name="Today" xsi:type="ParameterRef"/>
                  <operand localId="193" locator="233:18-233:24" value="1" unit="years" xsi:type="Quantity"/>
               </then>
            </caseItem>
            <caseItem localId="200" locator="234:3-235:25">
               <when localId="196" locator="234:8-234:52" name="Schedule quarterly retesting for PrEP users" xsi:type="ExpressionRef"/>
               <then localId="199" locator="235:10-235:25" xsi:type="Add">
                  <signature name="t:Date" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="197" locator="235:10-235:14" name="Today" xsi:type="ParameterRef"/>
                  <operand localId="198" locator="235:18-235:25" value="3" unit="months" xsi:type="Quantity"/>
               </then>
            </caseItem>
            <else asType="t:Date" xsi:type="As">
               <operand localId="201" locator="236:8-236:11" xsi:type="Null"/>
            </else>
         </expression>
      </def>
   </statements>
</library>
